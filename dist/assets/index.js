(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const Ye=class Ye{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?Ye.DefaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let s=0;s<t;s++)this._ptr[s]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let o=this._size;o<t;o++)typeof e=="function"?this._ptr[o]=JSON.parse(JSON.stringify(new e)):this._ptr[o]=e;else for(let o=this._size;o<t;o++)this._ptr[o]=e;else{const o=this._size-t;this._ptr.splice(this._size-o,o)}this._size=t}insert(t,e,i){let s=t._index;const o=e._index,u=i._index,c=u-o;this.prepareCapacity(this._size+c);const h=this._size-s;if(h>0)for(let d=0;d<h;d++)this._ptr.splice(s+d,0,null);for(let d=o;d<u;d++,s++)this._ptr[s]=e._vector._ptr[d];this._size=this._size+c}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new xi(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new xi(this,0)}end(){return new xi(this,this._size)}getOffset(t){const e=new Ye;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};Ye.DefaultSize=10;let A=Ye,xi=class Zi{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Zi(this._vector,this._index++)}decrement(){return new Zi(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var Or;(a=>{a.csmVector=A,a.iterator=xi})(Or||(Or={}));class kt{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var Dr;(a=>{a.csmString=kt})(Dr||(Dr={}));class Te{static createIdInternal(t){return new Te(t)}getString(){return this._id}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof kt?this._id.isEqual(t.s):t instanceof Te?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof kt?!this._id.isEqual(t.s):t instanceof Te?!this._id.isEqual(t._id.s):!1}constructor(t){if(typeof t=="string"){this._id=new kt(t);return}this._id=t}}var kr;(a=>{a.CubismId=Te})(kr||(kr={}));class Zs{constructor(){this._ids=new A}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=Te.createIdInternal(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var Nr;(a=>{a.CubismIdManager=Zs})(Nr||(Nr={}));class pt{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),o=4;for(let u=0;u<o;++u)for(let c=0;c<o;++c)for(let h=0;h<o;++h)s[c+u*4]+=t[h+u*4]*e[c+h*4];for(let u=0;u<16;++u)i[u]=s[u]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);pt.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);pt.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){pt.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new pt;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var Ur;(a=>{a.CubismMatrix44=pt})(Ur||(Ur={}));class Si{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var zr;(a=>{a.csmRect=Si})(zr||(zr={}));class Fi{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.r=t,this._modelColor.g=e,this._modelColor.b=i,this._modelColor.a=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(t){const e=this.getModelColor();return e.a*=t,this.isPremultipliedAlpha()&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new Rt,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new pt,this._mvpMatrix4x4.loadIdentity()}}var ae=(a=>(a[a.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",a[a.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",a[a.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",a))(ae||{});class Rt{constructor(t=1,e=1,i=1,s=1){this.r=t,this.g=e,this.b=i,this.a=s}}class dn{constructor(t,e){this._clippingIdList=t,this._clippingIdCount=e,this._allClippedDrawRect=new Si,this._layoutBounds=new Si,this._clippedDrawableIndexList=[],this._matrixForMask=new pt,this._matrixForDraw=new pt,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}}var jr;(a=>{a.CubismBlendMode=ae,a.CubismRenderer=Fi,a.CubismTextureColor=Rt})(jr||(jr={}));const _n=(a,t,e)=>{rr.print(a,"[CSM]"+t,e)},_i=(a,t,e)=>{_n(a,t+`
`,e)},It=a=>{console.assert(a)};let $e,Vt,ot,lt;$e=(a,...t)=>{_i(fe.LogLevel_Debug,"[D]"+a,t)},Vt=(a,...t)=>{_i(fe.LogLevel_Info,"[I]"+a,t)},ot=(a,...t)=>{_i(fe.LogLevel_Warning,"[W]"+a,t)},lt=(a,...t)=>{_i(fe.LogLevel_Error,"[E]"+a,t)};class rr{static print(t,e,i){if(t<Z.getLoggingLevel())return;const s=Z.coreLogFunction;if(!s)return;const o=e.replace(/\{(\d+)\}/g,(u,c)=>i[c]);s(o)}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,`
`):s%8==0&&s>0&&this.print(t,"  "),this.print(t,"{0} ",[e[s]&255]);this.print(t,`
`)}constructor(){}}var Xr;(a=>{a.CubismDebug=rr})(Xr||(Xr={}));class Qs{constructor(t,e){this.first=t??null,this.second=e??null}}const He=class He{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}if(e!=-1){ot("The key `{0}` is already append.",t);return}this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new Qs(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<He.DefaultSize&&(t=He.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new ye(this,0)}end(){return new ye(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new ye(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)$e("{0} ,",this._keyValues[t]),$e(`
`)}};He.DefaultSize=10;let Tt=He;class ye{constructor(t,e){this._map=t??new Tt,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new ye(this._map,this._index++)}decrement(){const t=new ye(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var Gr;(a=>{a.csmMap=Tt,a.csmPair=Qs,a.iterator=ye})(Gr||(Gr={}));class Ci{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{if(typeof t[i]=="boolean"){const s=!!t[i];e.put(i,new Yt(s))}else if(typeof t[i]=="string"){const s=String(t[i]);e.put(i,new Le(s))}else if(typeof t[i]=="number"){const s=Number(t[i]);e.put(i,new Pi(s))}else t[i]instanceof Array?e.put(i,Ci.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,Ci.parseJsonObject(t[i],new Ae)):t[i]==null?e.put(i,new Ee):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new sr;return Object.keys(t).forEach(i=>{if(typeof Number(i)=="number")if(typeof t[i]=="boolean"){const o=!!t[i];e.add(new Yt(o))}else if(typeof t[i]=="string"){const o=String(t[i]);e.add(new Le(o))}else if(typeof t[i]=="number"){const o=Number(t[i]);e.add(new Pi(o))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new Ae)):t[i]==null?e.add(new Ee):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new Ae));else if(t[i]==null)e.add(new Ee);else{const o=Array(t[i]);for(let u=0;u<o.length;u++)e.add(o[u])}}),e}}const Mi="Error: type mismatch",fn="Error: index out of bounds";let wt=class $t{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new A){return t}getMap(t){return t}getValueByIndex(t){return $t.errorValue.setErrorNotForClientCall(Mi)}getValueByString(t){return $t.nullValue.setErrorNotForClientCall(Mi)}getKeys(){return $t.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return Je.errorValue}static staticInitializeNotForClientCall(){Yt.trueValue=new Yt(!0),Yt.falseValue=new Yt(!1),$t.errorValue=new Je("ERROR",!0),$t.nullValue=new Ee,$t.dummyKeys=new A}static staticReleaseNotForClientCall(){Yt.trueValue=null,Yt.falseValue=null,$t.errorValue=null,$t.nullValue=null,$t.dummyKeys=null}};class Mt{constructor(t,e){this._parseCallback=Ci.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new Mt;return i.parseBytes(t,e,i._parseCallback)?i:(Mt.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let s=0,o=e.length;s<o;++s)i+="%"+this.pad(e[s].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const s=new Array(1),o=Mt.arrayBufferToString(t);if(i==null?this._root=this.parseValue(o,e,0,s):this._root=i(JSON.parse(o),new Ae),this._error){let u="\0";return u="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new Le(u),Vt("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new Je(new kt(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,s){if(this._error)return null;let o=null,u=i,c;for(;u<e;u++)switch(t[u]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const d=new Array(1);return c=mn(t.slice(u),d),s[0]=t.indexOf(d[0]),new Pi(c)}case'"':return new Le(this.parseString(t,e,u+1,s));case"[":return o=this.parseArray(t,e,u+1,s),o;case"{":return o=this.parseObject(t,e,u+1,s),o;case"n":return u+3<e?(o=new Ee,s[0]=u+4):this._error="parse null",o;case"t":return u+3<e?(o=Yt.trueValue,s[0]=u+4):this._error="parse true",o;case"f":return u+4<e?(o=Yt.falseValue,s[0]=u+5):this._error="illegal ',' position",o;case",":return this._error="illegal ',' position",null;case"]":return s[0]=u,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,s){if(this._error)return null;if(!t)return this._error="string is null",null;let o=i,u,c;const h=new kt("");let d=i;for(;o<e;o++)switch(u=t[o],u){case'"':return s[0]=o+1,h.append(t.slice(d),o-d),h.s;case"//":if(o++,o-1>d&&h.append(t.slice(d),o-d),d=o+1,o<e)switch(c=t[o],c){case"\\":h.expansion(1,"\\");break;case'"':h.expansion(1,'"');break;case"/":h.expansion(1,"/");break;case"b":h.expansion(1,"\b");break;case"f":h.expansion(1,"\f");break;case"n":h.expansion(1,`
`);break;case"r":h.expansion(1,"\r");break;case"t":h.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,s){if(this._error)return null;if(!t)return this._error="buffer is null",null;const o=new Ae;let u="",c=i,h="";const d=Array(1);let _=!1;for(;c<e;c++){t:for(;c<e;c++)switch(h=t[c],h){case'"':if(u=this.parseString(t,e,c+1,d),this._error)return null;c=d[0],_=!0;break t;case"}":return s[0]=c+1,o;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!_)return this._error="key not found",null;_=!1;t:for(;c<e;c++)switch(h=t[c],h){case":":_=!0,c++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!_)return this._error="':' not found",null;const y=this.parseValue(t,e,c,d);if(this._error)return null;c=d[0],o.put(u,y);t:for(;c<e;c++)switch(h=t[c],h){case",":break t;case"}":return s[0]=c+1,o;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,s){if(this._error)return null;if(!t)return this._error="buffer is null",null;let o=new sr,u=i,c;const h=new Array(1);for(;u<e;u++){const d=this.parseValue(t,e,u,h);if(this._error)return null;u=h[0],d&&o.add(d);t:for(;u<e;u++)switch(c=t[u],c){case",":break t;case"]":return s[0]=u+1,o;case`
`:++this._lineCount}}return o=void 0,this._error="illegal end of parseObject",null}}class Pi extends wt{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class Yt extends wt{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}constructor(t){super(),this._boolValue=t}}class Le extends wt{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof kt&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof kt?this._stringBuffer==t.s:!1}}class Je extends Le{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){typeof t=="string"?super(t):super(t),this._isStatic=e}isError(){return!0}}class Ee extends wt{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,Je.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class sr extends wt{constructor(){super(),this._array=new A}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return wt.errorValue.setErrorNotForClientCall(fn);const e=this._array.at(t);return e??wt.nullValue}getValueByString(t){return wt.errorValue.setErrorNotForClientCall(Mi)}getString(t,e){const i=e+`[
`;for(let s=this._array.begin();s.notEqual(this._array.end());s.increment()){const o=s.ptr();this._stringBuffer+=e+""+o.getString(e+" ")+`
`}return this._stringBuffer=i+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class Ae extends wt{constructor(){super(),this._map=new Tt}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof kt){const e=this._map.getValue(t.s);return e??wt.nullValue}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?wt.nullValue:e.ptr().second;return wt.nullValue}getValueByIndex(t){return wt.errorValue.setErrorNotForClientCall(Mi)}getString(t,e){this._stringBuffer=e+`{
`;const i=this._map.begin();for(;i.notEqual(this._map.end());){const s=i.ptr().first,o=i.ptr().second;this._stringBuffer+=e+" "+s+" : "+o.getString(e+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new A;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var Yr;(a=>{a.CubismJson=Mt,a.JsonArray=sr,a.JsonBoolean=Yt,a.JsonError=Je,a.JsonFloat=Pi,a.JsonMap=Ae,a.JsonNullvalue=Ee,a.JsonString=Le,a.Value=wt})(Yr||(Yr={}));function mn(a,t){let e=0;for(let s=1;;s++){const o=a.slice(s-1,s);if(o=="e"||o=="-"||o=="E")continue;const u=a.substring(0,s),c=Number(u);if(isNaN(c))break;e=s}let i=parseFloat(a);return isNaN(i)&&(i=NaN),t[0]=a.slice(e),i}let Xt=!1,Me=!1,Pe=null,Ue=null;const re=Object.freeze({vertexOffset:0,vertexStep:2});function Ie(a){a&&(a=void 0)}class Z{static startUp(t=null){if(Xt)return Vt("CubismFramework.startUp() is already done."),Xt;if(Pe=t,Pe!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Pe.logFunction),Xt=!0,Xt){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,s=(e&16711680)>>16,o=e&65535,u=e;Vt("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+s).slice(-2),("0000"+o).slice(-4),u)}return Vt("CubismFramework.startUp() is complete."),Xt}static cleanUp(){Xt=!1,Me=!1,Pe=null,Ue=null}static initialize(t=0){if(It(Xt),!Xt){ot("CubismFramework is not started.");return}if(Me){ot("CubismFramework.initialize() skipped, already initialized.");return}wt.staticInitializeNotForClientCall(),Ue=new Zs,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Me=!0,Vt("CubismFramework.initialize() is complete.")}static dispose(){if(It(Xt),!Xt){ot("CubismFramework is not started.");return}if(!Me){ot("CubismFramework.dispose() skipped, not initialized.");return}wt.staticReleaseNotForClientCall(),Ue.release(),Ue=null,Fi.staticRelease(),Me=!1,Vt("CubismFramework.dispose() is complete.")}static isStarted(){return Xt}static isInitialized(){return Me}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Pe!=null?Pe.loggingLevel:5}static getIdManager(){return Ue}constructor(){}}class pn{}var fe=(a=>(a[a.LogLevel_Verbose=0]="LogLevel_Verbose",a[a.LogLevel_Debug=1]="LogLevel_Debug",a[a.LogLevel_Info=2]="LogLevel_Info",a[a.LogLevel_Warning=3]="LogLevel_Warning",a[a.LogLevel_Error=4]="LogLevel_Error",a[a.LogLevel_Off=5]="LogLevel_Off",a))(fe||{}),Hr;(a=>{a.Constant=re,a.csmDelete=Ie,a.CubismFramework=Z})(Hr||(Hr={}));const me={width:400,height:500},ze=1,Wr=1,yn=2,vn=.8,xn=-1,Sn=1,Cn=-2,Mn=2,Pn=-2,bn=2,ta="/live2d-demo/Resources/",wn="",Bn="",Qi=["Reimy"],Fn=Qi.length,In="Idle",Vn="TapBody",Rn="Head",Tn="Body",En=0,An=1,Ln=2,On=3,Dn=fe.LogLevel_Warning,Ve=class Ve{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this.deltaTime}static updateTime(){this.currentFrame=Date.now(),this.deltaTime=(this.currentFrame-this.lastFrame)/1e3,this.lastFrame=this.currentFrame}static printMessage(t){console.log(t)}};Ve.lastUpdate=Date.now(),Ve.currentFrame=0,Ve.lastFrame=0,Ve.deltaTime=0;let yt=Ve;class kn{constructor(){this._gl=null,this._gl=null}initialize(t){return this._gl=t.getContext("webgl2"),this._gl?!0:(alert("Cannot initialize WebGL. This browser does not support."),this._gl=null,!1)}release(){}getGl(){return this._gl}}const D=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var $r;(a=>{a.HitAreaBody=D.HitAreaBody,a.HitAreaHead=D.HitAreaHead,a.HitAreaPrefix=D.HitAreaPrefix,a.ParamAngleX=D.ParamAngleX,a.ParamAngleY=D.ParamAngleY,a.ParamAngleZ=D.ParamAngleZ,a.ParamArmLA=D.ParamArmLA,a.ParamArmLB=D.ParamArmLB,a.ParamArmRA=D.ParamArmRA,a.ParamArmRB=D.ParamArmRB,a.ParamBaseX=D.ParamBaseX,a.ParamBaseY=D.ParamBaseY,a.ParamBodyAngleX=D.ParamBodyAngleX,a.ParamBodyAngleY=D.ParamBodyAngleY,a.ParamBodyAngleZ=D.ParamBodyAngleZ,a.ParamBreath=D.ParamBreath,a.ParamBrowLAngle=D.ParamBrowLAngle,a.ParamBrowLForm=D.ParamBrowLForm,a.ParamBrowLX=D.ParamBrowLX,a.ParamBrowLY=D.ParamBrowLY,a.ParamBrowRAngle=D.ParamBrowRAngle,a.ParamBrowRForm=D.ParamBrowRForm,a.ParamBrowRX=D.ParamBrowRX,a.ParamBrowRY=D.ParamBrowRY,a.ParamBustX=D.ParamBustX,a.ParamBustY=D.ParamBustY,a.ParamCheek=D.ParamCheek,a.ParamEyeBallForm=D.ParamEyeBallForm,a.ParamEyeBallX=D.ParamEyeBallX,a.ParamEyeBallY=D.ParamEyeBallY,a.ParamEyeLOpen=D.ParamEyeLOpen,a.ParamEyeLSmile=D.ParamEyeLSmile,a.ParamEyeROpen=D.ParamEyeROpen,a.ParamEyeRSmile=D.ParamEyeRSmile,a.ParamHairBack=D.ParamHairBack,a.ParamHairFluffy=D.ParamHairFluffy,a.ParamHairFront=D.ParamHairFront,a.ParamHairSide=D.ParamHairSide,a.ParamHandL=D.ParamHandL,a.ParamHandR=D.ParamHandR,a.ParamMouthForm=D.ParamMouthForm,a.ParamMouthOpenY=D.ParamMouthOpenY,a.ParamNONE=D.ParamNONE,a.ParamShoulderY=D.ParamShoulderY,a.PartsArmLPrefix=D.PartsArmLPrefix,a.PartsArmPrefix=D.PartsArmPrefix,a.PartsArmRPrefix=D.PartsArmRPrefix,a.PartsIdCore=D.PartsIdCore})($r||($r={}));class ea{}var Jr;(a=>{a.ICubismModelSetting=ea})(Jr||(Jr={}));var ia=(a=>(a[a.FrequestNode_Groups=0]="FrequestNode_Groups",a[a.FrequestNode_Moc=1]="FrequestNode_Moc",a[a.FrequestNode_Motions=2]="FrequestNode_Motions",a[a.FrequestNode_Expressions=3]="FrequestNode_Expressions",a[a.FrequestNode_Textures=4]="FrequestNode_Textures",a[a.FrequestNode_Physics=5]="FrequestNode_Physics",a[a.FrequestNode_Pose=6]="FrequestNode_Pose",a[a.FrequestNode_HitAreas=7]="FrequestNode_HitAreas",a))(ia||{});class ra extends ea{constructor(t,e){super(),this.version="Version",this.fileReferences="FileReferences",this.groups="Groups",this.layout="Layout",this.hitAreas="HitAreas",this.moc="Moc",this.textures="Textures",this.physics="Physics",this.pose="Pose",this.expressions="Expressions",this.motions="Motions",this.userData="UserData",this.name="Name",this.filePath="File",this.id="Id",this.ids="Ids",this.target="Target",this.idle="Idle",this.tapBody="TapBody",this.pinchIn="PinchIn",this.pinchOut="PinchOut",this.shake="Shake",this.flickHead="FlickHead",this.parameter="Parameter",this.soundPath="Sound",this.fadeInTime="FadeInTime",this.fadeOutTime="FadeOutTime",this.centerX="CenterX",this.centerY="CenterY",this.x="X",this.y="Y",this.width="Width",this.height="Height",this.lipSync="LipSync",this.eyeBlink="EyeBlink",this.initParameter="init_param",this.initPartsVisible="init_parts_visible",this.val="val",this._json=Mt.create(t,e),this.getJson()&&(this._jsonValue=new A,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.groups)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.moc)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.motions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.expressions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.textures)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.physics)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.pose)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.hitAreas)))}release(){Mt.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let s="";for(let o=0;o<i;o++)s+=e[o],o<i-1&&(s+="/");return s}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return Z.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(this.id).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(this.name).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(this.name).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(this.filePath).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.filePath).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.soundPath).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.fadeInTime).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.fadeOutTime).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData).getRawString():""}getLayoutMap(t){const e=this.getJson().getRoot().getValueByString(this.layout).getMap();if(e==null)return!1;let i=!1;for(const s=e.begin();s.notEqual(e.end());s.preIncrement())t.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(this.name).getRawString()==this.eyeBlink){t=i.getValueByString(this.ids).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(this.name).getRawString()==this.eyeBlink)return Z.getIdManager().getId(i.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(this.name).getRawString()==this.lipSync){t=i.getValueByString(this.ids).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(this.name).getRawString()==this.lipSync)return Z.getIdManager().getId(i.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.soundPath);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.fadeInTime);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(this.fadeOutTime);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(this.name).getRawString()==this.eyeBlink)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(this.name).getRawString()==this.lipSync)return!0;return!1}}var qr;(a=>{a.CubismModelSettingJson=ra,a.FrequestNode=ia})(qr||(qr={}));class ri{static create(){return new ri}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*Math.PI;for(let s=0;s<this._breathParameters.getSize();++s){const o=this._breathParameters.at(s);t.addParameterValueById(o.parameterId,o.offset+o.peak*Math.sin(i/o.cycle),o.weight)}}constructor(){this._currentTime=0}}class Fe{constructor(t,e,i,s,o){this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=s??0,this.weight=o??0}}var Kr;(a=>{a.BreathParameterData=Fe,a.CubismBreath=ri})(Kr||(Kr={}));const We=class We{static create(t=null){return new We(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,s=0;switch(this._blinkingState){case 2:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case 3:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}We.CloseIfZero||(i=-i);for(let u=0;u<this._parameterIds.getSize();++u)t.setParameterValueById(this._parameterIds.at(u),i)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new A,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};We.CloseIfZero=!0;let qe=We;var sa=(a=>(a[a.EyeState_First=0]="EyeState_First",a[a.EyeState_Interval=1]="EyeState_Interval",a[a.EyeState_Closing=2]="EyeState_Closing",a[a.EyeState_Closed=3]="EyeState_Closed",a[a.EyeState_Opening=4]="EyeState_Opening",a))(sa||{}),Zr;(a=>{a.CubismEyeBlink=qe,a.EyeState=sa})(Zr||(Zr={}));const Nn=.001,Ui=.5,Qr="FadeInTime",ts="Link",Un="Groups",zn="Id";class Ke{static create(t,e){const i=Mt.create(t,e);if(!i)return null;const s=new Ke,o=i.getRoot();o.getValueByString(Qr).isNull()||(s._fadeTimeSeconds=o.getValueByString(Qr).toFloat(Ui),s._fadeTimeSeconds<0&&(s._fadeTimeSeconds=Ui));const u=o.getValueByString(Un),c=u.getSize();for(let h=0;h<c;++h){const d=u.getValueByIndex(h),_=d.getSize();let y=0;for(let S=0;S<_;++S){const f=d.getValueByIndex(S),x=new Ze,w=Z.getIdManager().getId(f.getValueByString(zn).getRawString());if(x.partId=w,!f.getValueByString(ts).isNull()){const b=f.getValueByString(ts),L=b.getSize();for(let E=0;E<L;++E){const I=new Ze,X=Z.getIdManager().getId(b.getValueByIndex(E).getString());I.partId=X,x.link.pushBack(I)}}s._partGroups.pushBack(x.clone()),++y}s._partGroupCounts.pushBack(y)}return Mt.delete(i),s}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.getSize();s++){const o=this._partGroupCounts.at(s);this.doFade(t,e,i,o),i+=o}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const s=this._partGroupCounts.at(i);for(let o=e;o<e+s;++o){this._partGroups.at(o).initialize(t);const u=this._partGroups.at(o).partIndex,c=this._partGroups.at(o).parameterIndex;if(!(u<0)){t.setPartOpacityByIndex(u,o==e?1:0),t.setParameterValueByIndex(c,o==e?1:0);for(let h=0;h<this._partGroups.at(o).link.getSize();++h)this._partGroups.at(o).link.at(h).initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const s=this._partGroups.at(e).partIndex,o=t.getPartOpacityByIndex(s);for(let u=0;u<i.link.getSize();++u){const h=i.link.at(u).partIndex;h<0||t.setPartOpacityByIndex(h,o)}}}doFade(t,e,i,s){let o=-1,u=1;const c=.5,h=.15;for(let d=i;d<i+s;++d){const _=this._partGroups.at(d).partIndex,y=this._partGroups.at(d).parameterIndex;if(t.getParameterValueByIndex(y)>Nn){if(o>=0)break;if(o=d,this._fadeTimeSeconds==0){u=1;continue}u=t.getPartOpacityByIndex(_),u+=e/this._fadeTimeSeconds,u>1&&(u=1)}}o<0&&(o=0,u=1);for(let d=i;d<i+s;++d){const _=this._partGroups.at(d).partIndex;if(o==d)t.setPartOpacityByIndex(_,u);else{let y=t.getPartOpacityByIndex(_),S;u<c?S=u*(c-1)/c+1:S=(1-u)*c/(1-c),(1-S)*(1-u)>h&&(S=1-h/(1-u)),y>S&&(y=S),t.setPartOpacityByIndex(_,y)}}}constructor(){this._fadeTimeSeconds=Ui,this._lastModel=null,this._partGroups=new A,this._partGroupCounts=new A}}class Ze{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new A,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Ze;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new A;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var es;(a=>{a.CubismPose=Ke,a.PartData=Ze})(es||(es={}));class aa extends pt{constructor(t,e){super(),this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",i="height",u="center_x",c="center_y",d="bottom",_="left",y="right";for(const S=t.begin();S.notEqual(t.end());S.preIncrement()){const f=S.ptr().first,x=S.ptr().second;f==e?this.setWidth(x):f==i&&this.setHeight(x)}for(const S=t.begin();S.notEqual(t.end());S.preIncrement()){const f=S.ptr().first,x=S.ptr().second;f=="x"?this.setX(x):f=="y"?this.setY(x):f==u?this.centerX(x):f==c?this.centerY(x):f=="top"?this.top(x):f==d?this.bottom(x):f==_?this.left(x):f==y&&this.right(x)}}}var is;(a=>{a.CubismModelMatrix=aa})(is||(is={}));class N{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new N(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new N(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new N(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new N(t,t))}division(t){const e=new N(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new N(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var rs;(a=>{a.CubismVector2=N})(rs||(rs={}));const Re=class Re{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let s;return e===1/0?s=1/0:(s=Math.exp(Math.log(e)/3),s=(e/(s*s)+2*s)/3),i?-s:s}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static clamp(t,e,i){return t<e?e:i<t?i:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),s=Math.atan2(t.y,t.x);let o=i-s;for(;o<-Math.PI;)o+=Math.PI*2;for(;o>Math.PI;)o-=Math.PI*2;return o}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new N;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<Re.Epsilon?this.abs(e)<Re.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,s){if(this.abs(t)<Re.Epsilon)return this.range(this.quadraticEquation(e,i,s),0,1);const o=e/t,u=i/t,c=s/t,h=(3*u-o*o)/3,d=h/3,_=(2*o*o*o-9*o*u+27*c)/27,y=_/2,S=y*y+d*d*d,f=.5,x=f+.01;if(S<0){const I=-h/3,X=I*I*I,j=this.sqrt(X),R=-_/(2*j),J=this.range(R,-1,1),gt=Math.acos(J),v=2*this.cbrt(j),P=v*this.cos(gt/3)-o/3;if(this.abs(P-f)<x)return this.range(P,0,1);const k=v*this.cos((gt+2*Math.PI)/3)-o/3;if(this.abs(k-f)<x)return this.range(k,0,1);const T=v*this.cos((gt+4*Math.PI)/3)-o/3;return this.range(T,0,1)}if(S==0){let I;y<0?I=this.cbrt(-y):I=-this.cbrt(y);const X=2*I-o/3;if(this.abs(X-f)<x)return this.range(X,0,1);const j=-I-o/3;return this.range(j,0,1)}const w=this.sqrt(S),b=this.cbrt(w-y),L=this.cbrt(w+y),E=b-L-o/3;return this.range(E,0,1)}static mod(t,e){if(!isFinite(t)||e===0||isNaN(t)||isNaN(e))return console.warn(`divided: ${t}, divisor: ${e} mod() returns 'NaN'.`),NaN;const i=Math.abs(t),s=Math.abs(e);let o=i-Math.floor(i/s)*s;return o*=Math.sign(t),o}constructor(){}};Re.Epsilon=1e-5;let z=Re;var ss;(a=>{a.CubismMath=z})(ss||(ss={}));const zi=30,as=.01;class na{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const i=40/10*1/zi;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const s=(this._userTimeSeconds-this._lastTimeSeconds)*zi;this._lastTimeSeconds=this._userTimeSeconds;const u=.15*zi,c=s*i/u,h=this._faceTargetX-this._faceX,d=this._faceTargetY-this._faceY;if(z.abs(h)<=as&&z.abs(d)<=as)return;const _=z.sqrt(h*h+d*d),y=i*h/_,S=i*d/_;let f=y-this._faceVX,x=S-this._faceVY;const w=z.sqrt(f*f+x*x);(w<-c||w>c)&&(f*=c/w,x*=c/w),this._faceVX+=f,this._faceVY+=x;{const b=.5*(z.sqrt(c*c+16*c*_-8*c*_)-c),L=z.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);L>b&&(this._faceVX*=b/L,this._faceVY*=b/L)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var ns;(a=>{a.CubismTargetPoint=na})(ns||(ns={}));class Oe{constructor(){this.setBeganMotionHandler=t=>this._onBeganMotion=t,this.getBeganMotionHandler=()=>this._onBeganMotion,this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._isLoop=!1,this._isLoopFadeIn=!0,this._previousLoopState=this._isLoop,this._firedEventValues=new A}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;this.setupMotionQueueEntry(e,i);const s=this.updateFadeWeight(e,i);this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setupMotionQueueEntry(t,e){t==null||t.isStarted()||t.isAvailable()&&(t.setIsStarted(!0),t.setStartTime(e-this._offsetSeconds),t.setFadeInStartTime(e),t.getEndTime()<0&&this.adjustEndTime(t),t._motion._onBeganMotion&&t._motion._onBeganMotion(t._motion))}updateFadeWeight(t,e){t==null&&rr.print(fe.LogLevel_Error,"motionQueueEntry is null.");let i=this._weight;const s=this._fadeInSeconds==0?1:z.getEasingSine((e-t.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||t.getEndTime()<0?1:z.getEasingSine((t.getEndTime()-e)/this._fadeOutSeconds);return i=i*s*o,t.setState(e,i),It(0<=i&&i<=1),i}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}setLoop(t){this._isLoop=t}getLoop(){return this._isLoop}setLoopFadeIn(t){this._isLoopFadeIn=t}getLoopFadeIn(){return this._isLoopFadeIn}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}adjustEndTime(t){const e=this.getDuration(),i=e<=0?-1:t.getStartTime()+e;t.setEndTime(i)}}var os;(a=>{a.ACubismMotion=Oe})(os||(os={}));const jn="FadeInTime",Xn="FadeOutTime",ls="Parameters",Gn="Id",Yn="Value",fi="Blend",Hn="Add",Wn="Multiply",$n="Overwrite",us=1,Lt=class Lt extends Oe{static create(t,e){const i=new Lt;return i.parse(t,e),i}doUpdateParameters(t,e,i,s){for(let o=0;o<this._parameters.getSize();++o){const u=this._parameters.at(o);switch(u.blendType){case 0:{t.addParameterValueById(u.parameterId,u.value,i);break}case 1:{t.multiplyParameterValueById(u.parameterId,u.value,i);break}case 2:{t.setParameterValueById(u.parameterId,u.value,i);break}}}}calculateExpressionParameters(t,e,i,s,o,u){if(!(i==null||s==null)&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,e);for(let c=0;c<s.getSize();++c){const h=s.at(c);if(h.parameterId==null)continue;const d=h.overwriteValue=t.getParameterValueById(h.parameterId),_=this.getExpressionParameters();let y=-1;for(let b=0;b<_.getSize();++b)if(h.parameterId==_.at(b).parameterId){y=b;break}if(y<0){o==0?(h.additiveValue=Lt.DefaultAdditiveValue,h.multiplyValue=Lt.DefaultMultiplyValue,h.overwriteValue=d):(h.additiveValue=this.calculateValue(h.additiveValue,Lt.DefaultAdditiveValue,u),h.multiplyValue=this.calculateValue(h.multiplyValue,Lt.DefaultMultiplyValue,u),h.overwriteValue=this.calculateValue(h.overwriteValue,d,u));continue}const S=_.at(y).value;let f,x,w;switch(_.at(y).blendType){case 0:f=S,x=Lt.DefaultMultiplyValue,w=d;break;case 1:f=Lt.DefaultAdditiveValue,x=S,w=d;break;case 2:f=Lt.DefaultAdditiveValue,x=Lt.DefaultMultiplyValue,w=S;break;default:return}o==0?(h.additiveValue=f,h.multiplyValue=x,h.overwriteValue=w):(h.additiveValue=h.additiveValue*(1-u)+f*u,h.multiplyValue=h.multiplyValue*(1-u)+x*u,h.overwriteValue=h.overwriteValue*(1-u)+w*u)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(t,e){const i=Mt.create(t,e);if(!i)return;const s=i.getRoot();this.setFadeInTime(s.getValueByString(jn).toFloat(us)),this.setFadeOutTime(s.getValueByString(Xn).toFloat(us));const o=s.getValueByString(ls).getSize();this._parameters.prepareCapacity(o);for(let u=0;u<o;++u){const c=s.getValueByString(ls).getValueByIndex(u),h=Z.getIdManager().getId(c.getValueByString(Gn).getRawString()),d=c.getValueByString(Yn).toFloat();let _;c.getValueByString(fi).isNull()||c.getValueByString(fi).getString()==Hn?_=0:c.getValueByString(fi).getString()==Wn?_=1:c.getValueByString(fi).getString()==$n?_=2:_=0;const y=new la;y.parameterId=h,y.blendType=_,y.value=d,this._parameters.pushBack(y)}Mt.delete(i)}calculateValue(t,e,i){return t*(1-i)+e*i}constructor(){super(),this._parameters=new A,this._fadeWeight=0}};Lt.DefaultAdditiveValue=0,Lt.DefaultMultiplyValue=1;let se=Lt;var oa=(a=>(a[a.Additive=0]="Additive",a[a.Multiply=1]="Multiply",a[a.Overwrite=2]="Overwrite",a))(oa||{});class la{}var hs;(a=>{a.CubismExpressionMotion=se,a.ExpressionBlendType=oa,a.ExpressionParameter=la})(hs||(hs={}));class ua{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Oe.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}var cs;(a=>{a.CubismMotionQueueEntry=ua})(cs||(cs={}));class ar{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new A}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return Ge;let s=null;for(let o=0;o<this._motions.getSize();++o)s=this._motions.at(o),s!=null&&s.setFadeOut(s._motion.getFadeOutTime());return s=new ua,s._autoDelete=e,s._motion=t,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let s=this._motions.begin();s.notEqual(this._motions.end());){let o=s.ptr();if(o==null){s=this._motions.erase(s);continue}const u=o._motion;if(u==null){o.release(),o=null,s=this._motions.erase(s);continue}u.updateParameters(t,o,e),i=!0;const c=u.getFiredEvent(o.getLastCheckEventSeconds()-o.getStartTime(),e-o.getStartTime());for(let h=0;h<c.getSize();++h)this._eventCallBack(this,c.at(h),this._eventCustomData);o.setLastCheckEventSeconds(e),o.isFinished()?(o.release(),o=null,s=this._motions.erase(s)):(o.isTriggeredFadeOut()&&o.startFadeOut(o.getFadeOutSeconds(),e),s.preIncrement())}return i}}const Ge=-1;var gs;(a=>{a.CubismMotionQueueManager=ar,a.InvalidMotionQueueEntryHandleValue=Ge})(gs||(gs={}));class Jn{}class ha extends ar{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new A,this._fadeWeights=new A}release(){this._expressionParameterValues&&(Ie(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(Ie(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return Vt("CubismExpressionMotionManager.getCurrentPriority() is deprecated because a priority value is not actually used during expression motion playback."),this._currentPriority}getReservePriority(){return Vt("CubismExpressionMotionManager.getReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority}getFadeWeight(t){return t<0||this._fadeWeights.getSize()<1||t>=this._fadeWeights.getSize()?(console.warn("Failed to get the fade weight value. The element at that index does not exist."),-1):this._fadeWeights.at(t)}setFadeWeight(t,e){if(t<0||this._fadeWeights.getSize()<1||this._fadeWeights.getSize()<=t){console.warn("Failed to set the fade weight value. The element at that index does not exist.");return}this._fadeWeights.set(t,e)}setReservePriority(t){Vt("CubismExpressionMotionManager.setReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority=t}startMotionPriority(t,e,i){return Vt("CubismExpressionMotionManager.startMotionPriority() is deprecated because a priority value is not actually used during expression motion playback."),i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;let i=!1;const s=this.getCubismMotionQueueEntries();let o=0,u=0;if(this._fadeWeights.getSize()!==s.getSize()){const c=s.getSize()-this._fadeWeights.getSize();for(let h=0;h<c;h++)this._fadeWeights.pushBack(0)}for(let c=this._motions.begin();c.notEqual(this._motions.end());){const h=c.ptr();if(h==null){c=s.erase(c);continue}const d=h.getCubismMotion();if(d==null){Ie(h),c=s.erase(c);continue}const _=d.getExpressionParameters();if(h.isAvailable())for(let y=0;y<_.getSize();++y){if(_.at(y).parameterId==null)continue;let S=-1;for(let x=0;x<this._expressionParameterValues.getSize();++x)if(this._expressionParameterValues.at(x).parameterId==_.at(y).parameterId){S=x;break}if(S>=0)continue;const f=new Jn;f.parameterId=_.at(y).parameterId,f.additiveValue=se.DefaultAdditiveValue,f.multiplyValue=se.DefaultMultiplyValue,f.overwriteValue=t.getParameterValueById(f.parameterId),this._expressionParameterValues.pushBack(f)}d.setupMotionQueueEntry(h,this._userTimeSeconds),this.setFadeWeight(u,d.updateFadeWeight(h,this._userTimeSeconds)),d.calculateExpressionParameters(t,this._userTimeSeconds,h,this._expressionParameterValues,u,this.getFadeWeight(u)),o+=d.getFadeInTime()==0?1:z.getEasingSine((this._userTimeSeconds-h.getFadeInStartTime())/d.getFadeInTime()),i=!0,h.isTriggeredFadeOut()&&h.startFadeOut(h.getFadeOutSeconds(),this._userTimeSeconds),c.preIncrement(),++u}if(s.getSize()>1&&this.getFadeWeight(this._fadeWeights.getSize()-1)>=1)for(let h=s.getSize()-2;h>=0;--h){const d=s.at(h);Ie(d),s.remove(h),this._fadeWeights.remove(h)}o>1&&(o=1);for(let c=0;c<this._expressionParameterValues.getSize();++c){const h=this._expressionParameterValues.at(c);t.setParameterValueById(h.parameterId,(h.overwriteValue+h.additiveValue)*h.multiplyValue,o),h.additiveValue=se.DefaultAdditiveValue,h.multiplyValue=se.DefaultMultiplyValue}return i}}var ds;(a=>{a.CubismExpressionMotionManager=ha})(ds||(ds={}));var Gt=(a=>(a[a.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",a[a.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",a[a.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",a))(Gt||{}),xt=(a=>(a[a.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",a[a.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",a[a.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",a[a.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",a))(xt||{});class Qe{constructor(){this.time=0,this.value=0}}class ca{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class ga{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class da{constructor(){this.fireTime=0}}class _a{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new A,this.segments=new A,this.points=new A,this.events=new A}}var _s;(a=>{a.CubismMotionCurve=ga,a.CubismMotionCurveTarget=Gt,a.CubismMotionData=_a,a.CubismMotionEvent=da,a.CubismMotionPoint=Qe,a.CubismMotionSegment=ca,a.CubismMotionSegmentType=xt})(_s||(_s={}));const At="Meta",qn="Duration",Kn="Loop",Zn="AreBeziersRestricted",Qn="CurveCount",to="Fps",eo="TotalSegmentCount",io="TotalPointCount",qt="Curves",ro="Target",so="Id",mi="FadeInTime",pi="FadeOutTime",fs="Segments",ms="UserData",ao="UserDataCount",no="TotalUserDataSize",oo="Time",lo="Value";class fa{constructor(t,e){this._json=Mt.create(t,e)}release(){Mt.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(At).getValueByString(qn).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(At).getValueByString(Kn).toBoolean()}hasConsistency(){let t=!0;if(!this._json||!this._json.getRoot())return!1;const e=this._json.getRoot().getValueByString(qt).getVector().getSize();let i=0,s=0;for(let o=0;o<e;++o)for(let u=0;u<this.getMotionCurveSegmentCount(o);){switch(u==0&&(s+=1,u+=2),this.getMotionCurveSegment(o,u)){case xt.CubismMotionSegmentType_Linear:s+=1,u+=3;break;case xt.CubismMotionSegmentType_Bezier:s+=3,u+=7;break;case xt.CubismMotionSegmentType_Stepped:s+=1,u+=3;break;case xt.CubismMotionSegmentType_InverseStepped:s+=1,u+=3;break;default:It(0);break}++i}return e!=this.getMotionCurveCount()&&(ot("The number of curves does not match the metadata."),t=!1),i!=this.getMotionTotalSegmentCount()&&(ot("The number of segment does not match the metadata."),t=!1),s!=this.getMotionTotalPointCount()&&(ot("The number of point does not match the metadata."),t=!1),t}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(At).getValueByString(Zn).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(At).getValueByString(Qn).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(At).getValueByString(to).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(At).getValueByString(eo).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(At).getValueByString(io).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(At).getValueByString(mi).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(At).getValueByString(pi).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(At).getValueByString(mi).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(At).getValueByString(pi).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(ro).getRawString()}getMotionCurveId(t){return Z.getIdManager().getId(this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(so).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(mi).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(pi).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(mi).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(pi).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(fs).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(qt).getValueByIndex(t).getValueByString(fs).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(At).getValueByString(ao).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(At).getValueByString(no).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(ms).getValueByIndex(t).getValueByString(oo).toFloat()}getEventValue(t){return new kt(this._json.getRoot().getValueByString(ms).getValueByIndex(t).getValueByString(lo).getRawString())}}var ma=(a=>(a[a.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",a))(ma||{}),ps;(a=>{a.CubismMotionJson=fa})(ps||(ps={}));const uo="EyeBlink",ho="LipSync",co="Model",go="Parameter",_o="PartOpacity",yi="Opacity",fo=!1;function Dt(a,t,e){const i=new Qe;return i.time=a.time+(t.time-a.time)*e,i.value=a.value+(t.value-a.value)*e,i}function pa(a,t){let e=(t-a[0].time)/(a[1].time-a[0].time);return e<0&&(e=0),a[0].value+(a[1].value-a[0].value)*e}function mo(a,t){let e=(t-a[0].time)/(a[3].time-a[0].time);e<0&&(e=0);const i=Dt(a[0],a[1],e),s=Dt(a[1],a[2],e),o=Dt(a[2],a[3],e),u=Dt(i,s,e),c=Dt(s,o,e);return Dt(u,c,e).value}function po(a,t){const e=t,i=a[0].time,s=a[3].time,o=a[1].time,u=a[2].time,c=s-3*u+3*o-i,h=3*u-6*o+3*i,d=3*o-3*i,_=i-e,y=z.cardanoAlgorithmForBezier(c,h,d,_),S=Dt(a[0],a[1],y),f=Dt(a[1],a[2],y),x=Dt(a[2],a[3],y),w=Dt(S,f,y),b=Dt(f,x,y);return Dt(w,b,y).value}function ya(a,t){return a[0].value}function va(a,t){return a[1].value}function ji(a,t,e,i,s){const o=a.curves.at(t);let u=-1;const c=o.baseSegmentIndex+o.segmentCount;let h=0;for(let _=o.baseSegmentIndex;_<c;++_)if(h=a.segments.at(_).basePointIndex+(a.segments.at(_).segmentType==xt.CubismMotionSegmentType_Bezier?3:1),a.points.at(h).time>e){u=_;break}if(u==-1)return i&&e<s?yo(a,c-1,a.segments.at(o.baseSegmentIndex).basePointIndex,h,e,s):a.points.at(h).value;const d=a.segments.at(u);return d.evaluate(a.points.get(d.basePointIndex),e)}function yo(a,t,e,i,s,o){const u=[new Qe,new Qe];{const c=a.points.at(i);u[0].time=c.time,u[0].value=c.value}{const c=a.points.at(e);u[1].time=o,u[1].value=c.value}switch(a.segments.at(t).segmentType){case xt.CubismMotionSegmentType_Linear:case xt.CubismMotionSegmentType_Bezier:default:return pa(u,s);case xt.CubismMotionSegmentType_Stepped:return ya(u);case xt.CubismMotionSegmentType_InverseStepped:return va(u)}}class Ii extends Oe{constructor(){super(),this._motionBehavior=1,this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1,this._debugMode=!1}static create(t,e,i,s,o=!1){const u=new Ii;if(u.parse(t,e,o),u._motionData)u._sourceFrameRate=u._motionData.fps,u._loopDurationSeconds=u._motionData.duration,u._onFinishedMotion=i,u._onBeganMotion=s;else return Ie(u),null;return u}doUpdateParameters(t,e,i,s){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=Z.getIdManager().getId(uo)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=Z.getIdManager().getId(ho)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=Z.getIdManager().getId(yi)),this._motionBehavior===1&&this._previousLoopState!==this._isLoop&&(this.adjustEndTime(s),this._previousLoopState=this._isLoop);let o=e-s.getStartTime();o<0&&(o=0);let u=Number.MAX_VALUE,c=Number.MAX_VALUE;const h=64;let d=0,_=0;this._eyeBlinkParameterIds.getSize()>h&&$e("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>h&&$e("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const y=this._fadeInSeconds<=0?1:z.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),S=this._fadeOutSeconds<=0||s.getEndTime()<0?1:z.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let f,x,w,b=o,L=this._motionData.duration;const E=this._motionBehavior===1&&this._isLoop;if(this._isLoop)for(this._motionBehavior===1&&(L+=1/this._motionData.fps);b>L;)b-=L;const I=this._motionData.curves;for(x=0;x<this._motionData.curveCount&&I.at(x).type==Gt.CubismMotionCurveTarget_Model;++x)f=ji(this._motionData,x,b,E,L),I.at(x).id==this._modelCurveIdEyeBlink?c=f:I.at(x).id==this._modelCurveIdLipSync?u=f:I.at(x).id==this._modelCurveIdOpacity&&(this._modelOpacity=f,t.setModelOapcity(this.getModelOpacityValue()));for(;x<this._motionData.curveCount&&I.at(x).type==Gt.CubismMotionCurveTarget_Parameter;++x){if(w=t.getParameterIndex(I.at(x).id),w==-1)continue;const X=t.getParameterValueByIndex(w);if(f=ji(this._motionData,x,b,E,L),c!=Number.MAX_VALUE){for(let R=0;R<this._eyeBlinkParameterIds.getSize()&&R<h;++R)if(this._eyeBlinkParameterIds.at(R)==I.at(x).id){f*=c,_|=1<<R;break}}if(u!=Number.MAX_VALUE){for(let R=0;R<this._lipSyncParameterIds.getSize()&&R<h;++R)if(this._lipSyncParameterIds.at(R)==I.at(x).id){f+=u,d|=1<<R;break}}t.isRepeat(w)&&(f=t.getParameterRepeatValue(w,f));let j;if(I.at(x).fadeInTime<0&&I.at(x).fadeOutTime<0)j=X+(f-X)*i;else{let R,J;I.at(x).fadeInTime<0?R=y:R=I.at(x).fadeInTime==0?1:z.getEasingSine((e-s.getFadeInStartTime())/I.at(x).fadeInTime),I.at(x).fadeOutTime<0?J=S:J=I.at(x).fadeOutTime==0||s.getEndTime()<0?1:z.getEasingSine((s.getEndTime()-e)/I.at(x).fadeOutTime);const gt=this._weight*R*J;j=X+(f-X)*gt}t.setParameterValueByIndex(w,j,1)}{if(c!=Number.MAX_VALUE)for(let X=0;X<this._eyeBlinkParameterIds.getSize()&&X<h;++X){const j=t.getParameterValueById(this._eyeBlinkParameterIds.at(X));if(_>>X&1)continue;const R=j+(c-j)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(X),R)}if(u!=Number.MAX_VALUE)for(let X=0;X<this._lipSyncParameterIds.getSize()&&X<h;++X){const j=t.getParameterValueById(this._lipSyncParameterIds.at(X));if(d>>X&1)continue;const R=j+(u-j)*i;t.setParameterValueById(this._lipSyncParameterIds.at(X),R)}}for(;x<this._motionData.curveCount&&I.at(x).type==Gt.CubismMotionCurveTarget_PartOpacity;++x)w=t.getParameterIndex(I.at(x).id),w!=-1&&(f=ji(this._motionData,x,b,E,L),t.setParameterValueByIndex(w,f));o>=L&&(this._isLoop?this.updateForNextLoop(s,e,b):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){ot("setIsLoop() is a deprecated function. Please use setLoop()."),this._isLoop=t}isLoop(){return ot("isLoop() is a deprecated function. Please use getLoop()."),this._isLoop}setIsLoopFadeIn(t){ot("setIsLoopFadeIn() is a deprecated function. Please use setLoopFadeIn()."),this._isLoopFadeIn=t}isLoopFadeIn(){return ot("isLoopFadeIn() is a deprecated function. Please use getLoopFadeIn()."),this._isLoopFadeIn}setMotionBehavior(t){this._motionBehavior=t}getMotionBehavior(){return this._motionBehavior}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0,this._motionData=null}updateForNextLoop(t,e,i){switch(this._motionBehavior){case 1:default:t.setStartTime(e-i),this._isLoopFadeIn&&t.setFadeInStartTime(e-i),this._onFinishedMotion!=null&&this._onFinishedMotion(this);break;case 0:t.setStartTime(e),this._isLoopFadeIn&&t.setFadeInStartTime(e);break}}parse(t,e,i=!1){let s=new fa(t,e);if(!s){s.release(),s=void 0;return}if(i&&!s.hasConsistency()){s.release(),lt("Inconsistent motion3.json.");return}this._motionData=new _a,this._motionData.duration=s.getMotionDuration(),this._motionData.loop=s.isMotionLoop(),this._motionData.curveCount=s.getMotionCurveCount(),this._motionData.fps=s.getMotionFps(),this._motionData.eventCount=s.getEventCount();const o=s.getEvaluationOptionFlag(ma.EvaluationOptionFlag_AreBeziersRistricted);s.isExistMotionFadeInTime()?this._fadeInSeconds=s.getMotionFadeInTime()<0?1:s.getMotionFadeInTime():this._fadeInSeconds=1,s.isExistMotionFadeOutTime()?this._fadeOutSeconds=s.getMotionFadeOutTime()<0?1:s.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,ga,!0),this._motionData.segments.updateSize(s.getMotionTotalSegmentCount(),ca,!0),this._motionData.points.updateSize(s.getMotionTotalPointCount(),Qe,!0),this._motionData.events.updateSize(this._motionData.eventCount,da,!0);let u=0,c=0;for(let h=0;h<this._motionData.curveCount;++h){s.getMotionCurveTarget(h)==co?this._motionData.curves.at(h).type=Gt.CubismMotionCurveTarget_Model:s.getMotionCurveTarget(h)==go?this._motionData.curves.at(h).type=Gt.CubismMotionCurveTarget_Parameter:s.getMotionCurveTarget(h)==_o?this._motionData.curves.at(h).type=Gt.CubismMotionCurveTarget_PartOpacity:ot('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(h).id=s.getMotionCurveId(h),this._motionData.curves.at(h).baseSegmentIndex=c,this._motionData.curves.at(h).fadeInTime=s.isExistMotionCurveFadeInTime(h)?s.getMotionCurveFadeInTime(h):-1,this._motionData.curves.at(h).fadeOutTime=s.isExistMotionCurveFadeOutTime(h)?s.getMotionCurveFadeOutTime(h):-1;for(let d=0;d<s.getMotionCurveSegmentCount(h);){switch(d==0?(this._motionData.segments.at(c).basePointIndex=u,this._motionData.points.at(u).time=s.getMotionCurveSegment(h,d),this._motionData.points.at(u).value=s.getMotionCurveSegment(h,d+1),u+=1,d+=2):this._motionData.segments.at(c).basePointIndex=u-1,s.getMotionCurveSegment(h,d)){case xt.CubismMotionSegmentType_Linear:{this._motionData.segments.at(c).segmentType=xt.CubismMotionSegmentType_Linear,this._motionData.segments.at(c).evaluate=pa,this._motionData.points.at(u).time=s.getMotionCurveSegment(h,d+1),this._motionData.points.at(u).value=s.getMotionCurveSegment(h,d+2),u+=1,d+=3;break}case xt.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(c).segmentType=xt.CubismMotionSegmentType_Bezier,o||fo?this._motionData.segments.at(c).evaluate=mo:this._motionData.segments.at(c).evaluate=po,this._motionData.points.at(u).time=s.getMotionCurveSegment(h,d+1),this._motionData.points.at(u).value=s.getMotionCurveSegment(h,d+2),this._motionData.points.at(u+1).time=s.getMotionCurveSegment(h,d+3),this._motionData.points.at(u+1).value=s.getMotionCurveSegment(h,d+4),this._motionData.points.at(u+2).time=s.getMotionCurveSegment(h,d+5),this._motionData.points.at(u+2).value=s.getMotionCurveSegment(h,d+6),u+=3,d+=7;break}case xt.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(c).segmentType=xt.CubismMotionSegmentType_Stepped,this._motionData.segments.at(c).evaluate=ya,this._motionData.points.at(u).time=s.getMotionCurveSegment(h,d+1),this._motionData.points.at(u).value=s.getMotionCurveSegment(h,d+2),u+=1,d+=3;break}case xt.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(c).segmentType=xt.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(c).evaluate=va,this._motionData.points.at(u).time=s.getMotionCurveSegment(h,d+1),this._motionData.points.at(u).value=s.getMotionCurveSegment(h,d+2),u+=1,d+=3;break}default:{It(0);break}}++this._motionData.curves.at(h).segmentCount,++c}}for(let h=0;h<s.getEventCount();++h)this._motionData.events.at(h).fireTime=s.getEventTime(h),this._motionData.events.at(h).value=s.getEventValue(h);s.release(),s=void 0,s=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new kt(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(yi)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(yi)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves.at(t);if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(yi)==0)return Z.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}setDebugMode(t){this._debugMode=t}}var ys;(a=>{a.CubismMotion=Ii})(ys||(ys={}));class xa extends ar{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var vs;(a=>{a.CubismMotionManager=xa})(vs||(vs={}));var bi=(a=>(a[a.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",a))(bi||{}),ie=(a=>(a[a.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",a[a.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",a[a.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",a))(ie||{});class vo{constructor(){this.gravity=new N(0,0),this.wind=new N(0,0)}}class nr{}class tr{}class Sa{constructor(){this.initialPosition=new N(0,0),this.position=new N(0,0),this.lastPosition=new N(0,0),this.lastGravity=new N(0,0),this.force=new N(0,0),this.velocity=new N(0,0)}}class Ca{constructor(){this.normalizationPosition=new tr,this.normalizationAngle=new tr}}class Ma{constructor(){this.source=new nr}}class Pa{constructor(){this.destination=new nr,this.translationScale=new N(0,0)}}class ba{constructor(){this.settings=new A,this.inputs=new A,this.outputs=new A,this.particles=new A,this.gravity=new N(0,0),this.wind=new N(0,0),this.fps=0}}var xs;(a=>{a.CubismPhysicsInput=Ma,a.CubismPhysicsNormalization=tr,a.CubismPhysicsOutput=Pa,a.CubismPhysicsParameter=nr,a.CubismPhysicsParticle=Sa,a.CubismPhysicsRig=ba,a.CubismPhysicsSource=ie,a.CubismPhysicsSubRig=Ca,a.CubismPhysicsTargetType=bi,a.PhysicsJsonEffectiveForces=vo})(xs||(xs={}));const je="Position",Xi="X",Gi="Y",Yi="Angle",Ss="Type",Cs="Id",Kt="Meta",vi="EffectiveForces",xo="TotalInputCount",So="TotalOutputCount",Co="PhysicsSettingCount",Ms="Gravity",Ps="Wind",Mo="VertexCount",Po="Fps",dt="PhysicsSettings",be="Normalization",bs="Minimum",ws="Maximum",Bs="Default",Fs="Reflect",Is="Weight",Xe="Input",bo="Source",ge="Output",wo="Scale",Bo="VertexIndex",Fo="Destination",de="Vertices",Io="Mobility",Vo="Delay",Ro="Radius",To="Acceleration";class wa{constructor(t,e){this._json=Mt.create(t,e)}release(){Mt.delete(this._json)}getGravity(){const t=new N(0,0);return t.x=this._json.getRoot().getValueByString(Kt).getValueByString(vi).getValueByString(Ms).getValueByString(Xi).toFloat(),t.y=this._json.getRoot().getValueByString(Kt).getValueByString(vi).getValueByString(Ms).getValueByString(Gi).toFloat(),t}getWind(){const t=new N(0,0);return t.x=this._json.getRoot().getValueByString(Kt).getValueByString(vi).getValueByString(Ps).getValueByString(Xi).toFloat(),t.y=this._json.getRoot().getValueByString(Kt).getValueByString(vi).getValueByString(Ps).getValueByString(Gi).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(Kt).getValueByString(Po).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(Kt).getValueByString(Co).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(Kt).getValueByString(xo).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(Kt).getValueByString(So).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(Kt).getValueByString(Mo).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(je).getValueByString(bs).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(je).getValueByString(ws).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(je).getValueByString(Bs).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(Yi).getValueByString(bs).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(Yi).getValueByString(ws).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(be).getValueByString(Yi).getValueByString(Bs).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Xe).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Xe).getValueByIndex(e).getValueByString(Is).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Xe).getValueByIndex(e).getValueByString(Fs).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Xe).getValueByIndex(e).getValueByString(Ss).getRawString()}getInputSourceId(t,e){return Z.getIdManager().getId(this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Xe).getValueByIndex(e).getValueByString(bo).getValueByString(Cs).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Bo).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(wo).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Is).toFloat()}getOutputDestinationId(t,e){return Z.getIdManager().getId(this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Fo).getValueByString(Cs).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Ss).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Fs).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(Io).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(Vo).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(To).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(Ro).toFloat()}getParticlePosition(t,e){const i=new N(0,0);return i.x=this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(je).getValueByString(Xi).toFloat(),i.y=this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(de).getValueByIndex(e).getValueByString(je).getValueByString(Gi).toFloat(),i}}var Vs;(a=>{a.CubismPhysicsJson=wa})(Vs||(Vs={}));const Rs="X",Ts="Y",Es="Angle",Eo=5,er=100,As=.001,Ao=5;class ti{static create(t,e){const i=new ti;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new ba;let i=new wa(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Ca,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Ma,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Pa,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),Sa,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let s=0,o=0,u=0;for(let c=0;c<this._physicsRig.settings.getSize();++c){this._physicsRig.settings.at(c).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(c),this._physicsRig.settings.at(c).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(c),this._physicsRig.settings.at(c).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(c),this._physicsRig.settings.at(c).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(c),this._physicsRig.settings.at(c).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(c),this._physicsRig.settings.at(c).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(c),this._physicsRig.settings.at(c).inputCount=i.getInputCount(c),this._physicsRig.settings.at(c).baseInputIndex=s;for(let _=0;_<this._physicsRig.settings.at(c).inputCount;++_)this._physicsRig.inputs.at(s+_).sourceParameterIndex=-1,this._physicsRig.inputs.at(s+_).weight=i.getInputWeight(c,_),this._physicsRig.inputs.at(s+_).reflect=i.getInputReflect(c,_),i.getInputType(c,_)==Rs?(this._physicsRig.inputs.at(s+_).type=ie.CubismPhysicsSource_X,this._physicsRig.inputs.at(s+_).getNormalizedParameterValue=Oo):i.getInputType(c,_)==Ts?(this._physicsRig.inputs.at(s+_).type=ie.CubismPhysicsSource_Y,this._physicsRig.inputs.at(s+_).getNormalizedParameterValue=Do):i.getInputType(c,_)==Es&&(this._physicsRig.inputs.at(s+_).type=ie.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(s+_).getNormalizedParameterValue=ko),this._physicsRig.inputs.at(s+_).source.targetType=bi.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(s+_).source.id=i.getInputSourceId(c,_);s+=this._physicsRig.settings.at(c).inputCount,this._physicsRig.settings.at(c).outputCount=i.getOutputCount(c),this._physicsRig.settings.at(c).baseOutputIndex=o;const h=new Ls;h.outputs.resize(this._physicsRig.settings.at(c).outputCount);const d=new Ls;d.outputs.resize(this._physicsRig.settings.at(c).outputCount);for(let _=0;_<this._physicsRig.settings.at(c).outputCount;++_)h.outputs.set(_,0),d.outputs.set(_,0),this._physicsRig.outputs.at(o+_).destinationParameterIndex=-1,this._physicsRig.outputs.at(o+_).vertexIndex=i.getOutputVertexIndex(c,_),this._physicsRig.outputs.at(o+_).angleScale=i.getOutputAngleScale(c,_),this._physicsRig.outputs.at(o+_).weight=i.getOutputWeight(c,_),this._physicsRig.outputs.at(o+_).destination.targetType=bi.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(o+_).destination.id=i.getOutputDestinationId(c,_),i.getOutputType(c,_)==Rs?(this._physicsRig.outputs.at(o+_).type=ie.CubismPhysicsSource_X,this._physicsRig.outputs.at(o+_).getValue=No,this._physicsRig.outputs.at(o+_).getScale=Go):i.getOutputType(c,_)==Ts?(this._physicsRig.outputs.at(o+_).type=ie.CubismPhysicsSource_Y,this._physicsRig.outputs.at(o+_).getValue=Uo,this._physicsRig.outputs.at(o+_).getScale=Yo):i.getOutputType(c,_)==Es&&(this._physicsRig.outputs.at(o+_).type=ie.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(o+_).getValue=zo,this._physicsRig.outputs.at(o+_).getScale=Ho),this._physicsRig.outputs.at(o+_).reflect=i.getOutputReflect(c,_);this._currentRigOutputs.pushBack(h),this._previousRigOutputs.pushBack(d),o+=this._physicsRig.settings.at(c).outputCount,this._physicsRig.settings.at(c).particleCount=i.getParticleCount(c),this._physicsRig.settings.at(c).baseParticleIndex=u;for(let _=0;_<this._physicsRig.settings.at(c).particleCount;++_)this._physicsRig.particles.at(u+_).mobility=i.getParticleMobility(c,_),this._physicsRig.particles.at(u+_).delay=i.getParticleDelay(c,_),this._physicsRig.particles.at(u+_).acceleration=i.getParticleAcceleration(c,_),this._physicsRig.particles.at(u+_).radius=i.getParticleRadius(c,_),this._physicsRig.particles.at(u+_).position=i.getParticlePosition(c,_);u+=this._physicsRig.settings.at(c).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var w,b;let e,i,s,o;const u=new N;let c,h,d,_;const y=t.getModel().parameters.values,S=t.getModel().parameters.maximumValues,f=t.getModel().parameters.minimumValues,x=t.getModel().parameters.defaultValues;(((w=this._parameterCaches)==null?void 0:w.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((b=this._parameterInputCaches)==null?void 0:b.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let L=0;L<t.getParameterCount();++L)this._parameterCaches[L]=y[L],this._parameterInputCaches[L]=y[L];for(let L=0;L<this._physicsRig.subRigCount;++L){e={angle:0},u.x=0,u.y=0,c=this._physicsRig.settings.at(L),h=this._physicsRig.inputs.get(c.baseInputIndex),d=this._physicsRig.outputs.get(c.baseOutputIndex),_=this._physicsRig.particles.get(c.baseParticleIndex);for(let E=0;E<c.inputCount;++E)i=h[E].weight/er,h[E].sourceParameterIndex==-1&&(h[E].sourceParameterIndex=t.getParameterIndex(h[E].source.id)),h[E].getNormalizedParameterValue(u,e,y[h[E].sourceParameterIndex],f[h[E].sourceParameterIndex],S[h[E].sourceParameterIndex],x[h[E].sourceParameterIndex],c.normalizationPosition,c.normalizationAngle,h[E].reflect,i),this._parameterCaches[h[E].sourceParameterIndex]=y[h[E].sourceParameterIndex];s=z.degreesToRadian(-e.angle),u.x=u.x*z.cos(s)-u.y*z.sin(s),u.y=u.x*z.sin(s)+u.y*z.cos(s),$o(_,c.particleCount,u,e.angle,this._options.wind,As*c.normalizationPosition.maximum);for(let E=0;E<c.outputCount;++E){const I=d[E].vertexIndex;if(d[E].destinationParameterIndex==-1&&(d[E].destinationParameterIndex=t.getParameterIndex(d[E].destination.id)),I<1||I>=c.particleCount)continue;let X=new N;X=_[I].position.substract(_[I-1].position),o=d[E].getValue(X,_,I,d[E].reflect,this._options.gravity),this._currentRigOutputs.at(L).outputs.set(E,o),this._previousRigOutputs.at(L).outputs.set(E,o);const j=d[E].destinationParameterIndex,R=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(y.subarray(j))):y.slice(j);Hi(R,f[j],S[j],o,d[E]);for(let J=j,gt=0;J<this._parameterCaches.length;J++,gt++)y[J]=this._parameterCaches[J]=R[gt]}}}evaluate(t,e){var E,I;let i,s,o,u;const c=new N;let h,d,_,y;if(0>=e)return;const S=t.getModel().parameters.values,f=t.getModel().parameters.maximumValues,x=t.getModel().parameters.minimumValues,w=t.getModel().parameters.defaultValues;let b;if(this._currentRemainTime+=e,this._currentRemainTime>Ao&&(this._currentRemainTime=0),(((E=this._parameterCaches)==null?void 0:E.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((I=this._parameterInputCaches)==null?void 0:I.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let X=0;X<t.getParameterCount();++X)this._parameterInputCaches[X]=S[X]}for(this._physicsRig.fps>0?b=1/this._physicsRig.fps:b=e;this._currentRemainTime>=b;){for(let j=0;j<this._physicsRig.subRigCount;++j){h=this._physicsRig.settings.at(j),_=this._physicsRig.outputs.get(h.baseOutputIndex);for(let R=0;R<h.outputCount;++R)this._previousRigOutputs.at(j).outputs.set(R,this._currentRigOutputs.at(j).outputs.at(R))}const X=b/this._currentRemainTime;for(let j=0;j<t.getParameterCount();++j)this._parameterCaches[j]=this._parameterInputCaches[j]*(1-X)+S[j]*X,this._parameterInputCaches[j]=this._parameterCaches[j];for(let j=0;j<this._physicsRig.subRigCount;++j){i={angle:0},c.x=0,c.y=0,h=this._physicsRig.settings.at(j),d=this._physicsRig.inputs.get(h.baseInputIndex),_=this._physicsRig.outputs.get(h.baseOutputIndex),y=this._physicsRig.particles.get(h.baseParticleIndex);for(let R=0;R<h.inputCount;++R)s=d[R].weight/er,d[R].sourceParameterIndex==-1&&(d[R].sourceParameterIndex=t.getParameterIndex(d[R].source.id)),d[R].getNormalizedParameterValue(c,i,this._parameterCaches[d[R].sourceParameterIndex],x[d[R].sourceParameterIndex],f[d[R].sourceParameterIndex],w[d[R].sourceParameterIndex],h.normalizationPosition,h.normalizationAngle,d[R].reflect,s);o=z.degreesToRadian(-i.angle),c.x=c.x*z.cos(o)-c.y*z.sin(o),c.y=c.x*z.sin(o)+c.y*z.cos(o),Wo(y,h.particleCount,c,i.angle,this._options.wind,As*h.normalizationPosition.maximum,b,Eo);for(let R=0;R<h.outputCount;++R){const J=_[R].vertexIndex;if(_[R].destinationParameterIndex==-1&&(_[R].destinationParameterIndex=t.getParameterIndex(_[R].destination.id)),J<1||J>=h.particleCount)continue;const gt=new N;gt.x=y[J].position.x-y[J-1].position.x,gt.y=y[J].position.y-y[J-1].position.y,u=_[R].getValue(gt,y,J,_[R].reflect,this._options.gravity),this._currentRigOutputs.at(j).outputs.set(R,u);const st=_[R].destinationParameterIndex,v=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(st))):this._parameterCaches.slice(st);Hi(v,x[st],f[st],u,_[R]);for(let P=st,k=0;P<this._parameterCaches.length;P++,k++)this._parameterCaches[P]=v[k]}}this._currentRemainTime-=b}const L=this._currentRemainTime/b;this.interpolate(t,L)}interpolate(t,e){let i,s;const o=t.getModel().parameters.values,u=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues;for(let h=0;h<this._physicsRig.subRigCount;++h){s=this._physicsRig.settings.at(h),i=this._physicsRig.outputs.get(s.baseOutputIndex);for(let d=0;d<s.outputCount;++d){if(i[d].destinationParameterIndex==-1)continue;const _=i[d].destinationParameterIndex,y=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(o.subarray(_))):o.slice(_);Hi(y,c[_],u[_],this._previousRigOutputs.at(h).outputs.at(d)*(1-e)+this._currentRigOutputs.at(h).outputs.at(d)*e,i[d]);for(let S=_,f=0;S<o.length;S++,f++)o[S]=y[f]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Ba,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new A,this._previousRigOutputs=new A,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings.at(s),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new N(0,0),t[0].lastPosition=new N(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new N(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new N(0,0),t[0].force=new N(0,0);for(let o=1;o<e.particleCount;++o)i=new N(0,0),i.y=t[o].radius,t[o].initialPosition=new N(t[o-1].initialPosition.x+i.x,t[o-1].initialPosition.y+i.y),t[o].position=new N(t[o].initialPosition.x,t[o].initialPosition.y),t[o].lastPosition=new N(t[o].initialPosition.x,t[o].initialPosition.y),t[o].lastGravity=new N(0,-1),t[o].lastGravity.y*=-1,t[o].velocity=new N(0,0),t[o].force=new N(0,0)}}}class Ba{constructor(){this.gravity=new N(0,0),this.wind=new N(0,0)}}class Ls{constructor(){this.outputs=new A(0)}}function Lo(a){let t=0;return a>0?t=1:a<0&&(t=-1),t}function Oo(a,t,e,i,s,o,u,c,h,d){a.x+=or(e,i,s,o,u.minimum,u.maximum,u.defalut,h)*d}function Do(a,t,e,i,s,o,u,c,h,d){a.y+=or(e,i,s,o,u.minimum,u.maximum,u.defalut,h)*d}function ko(a,t,e,i,s,o,u,c,h,d){t.angle+=or(e,i,s,o,c.minimum,c.maximum,c.defalut,h)*d}function No(a,t,e,i,s){let o=a.x;return i&&(o*=-1),o}function Uo(a,t,e,i,s){let o=a.y;return i&&(o*=-1),o}function zo(a,t,e,i,s){let o;return e>=2?s=t[e-1].position.substract(t[e-2].position):s=s.multiplyByScaler(-1),o=z.directionToRadian(s,a),i&&(o*=-1),o}function jo(a,t){const e=z.max(a,t),i=z.min(a,t);return z.abs(e-i)}function Xo(a,t){return z.min(a,t)+jo(a,t)/2}function Go(a,t){return JSON.parse(JSON.stringify(a.x))}function Yo(a,t){return JSON.parse(JSON.stringify(a.y))}function Ho(a,t){return JSON.parse(JSON.stringify(t))}function Wo(a,t,e,i,s,o,u,c){let h,d,_=new N(0,0),y=new N(0,0),S=new N(0,0),f=new N(0,0);a[0].position=new N(e.x,e.y);const x=z.degreesToRadian(i),w=z.radianToDirection(x);w.normalize();for(let b=1;b<t;++b)a[b].force=w.multiplyByScaler(a[b].acceleration).add(s),a[b].lastPosition=new N(a[b].position.x,a[b].position.y),h=a[b].delay*u*30,_=a[b].position.substract(a[b-1].position),d=z.directionToRadian(a[b].lastGravity,w)/c,_.x=z.cos(d)*_.x-_.y*z.sin(d),_.y=z.sin(d)*_.x+_.y*z.cos(d),a[b].position=a[b-1].position.add(_),y=a[b].velocity.multiplyByScaler(h),S=a[b].force.multiplyByScaler(h).multiplyByScaler(h),a[b].position=a[b].position.add(y).add(S),f=a[b].position.substract(a[b-1].position),f.normalize(),a[b].position=a[b-1].position.add(f.multiplyByScaler(a[b].radius)),z.abs(a[b].position.x)<o&&(a[b].position.x=0),h!=0&&(a[b].velocity=a[b].position.substract(a[b].lastPosition),a[b].velocity=a[b].velocity.divisionByScalar(h),a[b].velocity=a[b].velocity.multiplyByScaler(a[b].mobility)),a[b].force=new N(0,0),a[b].lastGravity=new N(w.x,w.y)}function $o(a,t,e,i,s,o){let u=new N(0,0);a[0].position=new N(e.x,e.y);const c=z.degreesToRadian(i),h=z.radianToDirection(c);h.normalize();for(let d=1;d<t;++d)a[d].force=h.multiplyByScaler(a[d].acceleration).add(s),a[d].lastPosition=new N(a[d].position.x,a[d].position.y),a[d].velocity=new N(0,0),u=a[d].force,u.normalize(),u=u.multiplyByScaler(a[d].radius),a[d].position=a[d-1].position.add(u),z.abs(a[d].position.x)<o&&(a[d].position.x=0),a[d].force=new N(0,0),a[d].lastGravity=new N(h.x,h.y)}function Hi(a,t,e,i,s){let o;const u=s.getScale(s.translationScale,s.angleScale);o=i*u,o<t?(o<s.valueBelowMinimum&&(s.valueBelowMinimum=o),o=t):o>e&&(o>s.valueExceededMaximum&&(s.valueExceededMaximum=o),o=e);const c=s.weight/er;c>=1||(o=a[0]*(1-c)+o*c),a[0]=o}function or(a,t,e,i,s,o,u,c){let h=0;const d=z.max(e,t);d<a&&(a=d);const _=z.min(e,t);_>a&&(a=_);const y=z.min(s,o),S=z.max(s,o),f=u,x=Xo(_,d),w=a-x;switch(Lo(w)){case 1:{const b=S-f,L=d-x;L!=0&&(h=w*(b/L),h+=f);break}case-1:{const b=y-f,L=_-x;L!=0&&(h=w*(b/L),h+=f);break}case 0:{h=f;break}}return c?h:h*-1}var Os;(a=>{a.CubismPhysics=ti,a.Options=Ba})(Os||(Os={}));const Wi=4,Jo=36,qo=32;class Ko{constructor(t){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new A,this._clippingContextListForDraw=new A,this._channelColors=new A,this._tmpBoundsOnModel=new Si,this._tmpMatrix=new pt,this._tmpMatrixForMask=new pt,this._tmpMatrixForDraw=new pt,this._clippingContexttConstructor=t;let e=new Rt;e.r=1,e.g=0,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new Rt,e.r=0,e.g=1,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new Rt,e.r=0,e.g=0,e.b=1,e.a=0,this._channelColors.pushBack(e),e=new Rt,e.r=0,e.g=0,e.b=0,e.a=1,this._channelColors.pushBack(e)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null;for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this._clearedFrameBufferFlags!=null&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(t,e){e%1!=0&&(ot("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),e=~~e),e<1&&ot("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=e<1?1:e,this._clearedFrameBufferFlags=new A(this._renderTextureCount);for(let i=0;i<t.getDrawableCount();i++){if(t.getDrawableMaskCounts()[i]<=0){this._clippingContextListForDraw.pushBack(null);continue}let s=this.findSameClip(t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]);s==null&&(s=new this._clippingContexttConstructor(this,t.getDrawableMasks()[i],t.getDrawableMaskCounts()[i]),this._clippingContextListForMask.pushBack(s)),s.addClippedDrawable(i),this._clippingContextListForDraw.pushBack(s)}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),o=s._clippingIdCount;if(o!=e)continue;let u=0;for(let c=0;c<o;c++){const h=s._clippingIdList[c];for(let d=0;d<o;d++)if(t[d]==h){u++;break}}if(u==o)return s}return null}setupMatrixForHighPrecision(t,e){let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const o=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,o),o._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let s=0;s<this._renderTextureCount;s++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let s=0;s<this._renderTextureCount;s++)this._clearedFrameBufferFlags.set(s,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){const o=this._clippingContextListForMask.at(s),u=o._allClippedDrawRect,c=o._layoutBounds,h=.05;let d=0,_=0;const y=t.getPixelsPerUnit(),S=o.getClippingManager().getClippingMaskBufferSize(),f=c.width*S,x=c.height*S;this._tmpBoundsOnModel.setRect(u),this._tmpBoundsOnModel.width*y>f?(this._tmpBoundsOnModel.expand(u.width*h,0),d=c.width/this._tmpBoundsOnModel.width):d=y/f,this._tmpBoundsOnModel.height*y>x?(this._tmpBoundsOnModel.expand(0,u.height*h),_=c.height/this._tmpBoundsOnModel.height):_=y/x,this.createMatrixForMask(e,c,d,_),o._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),o._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(t,e,i,s){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(e.x,e.y),this._tmpMatrix.scaleRelative(i,s),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(e.x,e.y*(t?-1:1)),this._tmpMatrix.scaleRelative(i,s*(t?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(t){const e=this._renderTextureCount<=1?Jo:qo*this._renderTextureCount;if(t<=0||t>e){t>e&&lt(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let d=0;d<this._clippingContextListForMask.getSize();d++){const _=this._clippingContextListForMask.at(d);_._layoutChannelIndex=0,_._layoutBounds.x=0,_._layoutBounds.y=0,_._layoutBounds.width=1,_._layoutBounds.height=1,_._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let s=t/this._renderTextureCount;const o=t%this._renderTextureCount;s=Math.ceil(s);let u=s/Wi;const c=s%Wi;u=~~u;let h=0;for(let d=0;d<this._renderTextureCount;d++)for(let _=0;_<Wi;_++){let y=u+(_<c?1:0);const S=c+(u<1?-1:0);if(_==S&&o>0&&(y-=d<o?0:1),y!=0)if(y==1){const f=this._clippingContextListForMask.at(h++);f._layoutChannelIndex=_,f._layoutBounds.x=0,f._layoutBounds.y=0,f._layoutBounds.width=1,f._layoutBounds.height=1,f._bufferIndex=d}else if(y==2)for(let f=0;f<y;f++){let x=f%2;x=~~x;const w=this._clippingContextListForMask.at(h++);w._layoutChannelIndex=_,w._layoutBounds.x=x*.5,w._layoutBounds.y=0,w._layoutBounds.width=.5,w._layoutBounds.height=1,w._bufferIndex=d}else if(y<=4)for(let f=0;f<y;f++){let x=f%2,w=f/2;x=~~x,w=~~w;const b=this._clippingContextListForMask.at(h++);b._layoutChannelIndex=_,b._layoutBounds.x=x*.5,b._layoutBounds.y=w*.5,b._layoutBounds.width=.5,b._layoutBounds.height=.5,b._bufferIndex=d}else if(y<=i)for(let f=0;f<y;f++){let x=f%3,w=f/3;x=~~x,w=~~w;const b=this._clippingContextListForMask.at(h++);b._layoutChannelIndex=_,b._layoutBounds.x=x/3,b._layoutBounds.y=w/3,b._layoutBounds.width=1/3,b._layoutBounds.height=1/3,b._bufferIndex=d}else{lt(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let f=0;f<y;f++){const x=this._clippingContextListForMask.at(h++);x._layoutChannelIndex=0,x._layoutBounds.x=0,x._layoutBounds.y=0,x._layoutBounds.width=1,x._layoutBounds.height=1,x._bufferIndex=0}}}}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,o=Number.MIN_VALUE,u=Number.MIN_VALUE;const c=e._clippedDrawableIndexList.length;for(let h=0;h<c;h++){const d=e._clippedDrawableIndexList[h],_=t.getDrawableVertexCount(d),y=t.getDrawableVertices(d);let S=Number.MAX_VALUE,f=Number.MAX_VALUE,x=-Number.MAX_VALUE,w=-Number.MAX_VALUE;const b=_*re.vertexStep;for(let L=re.vertexOffset;L<b;L+=re.vertexStep){const E=y[L],I=y[L+1];E<S&&(S=E),E>x&&(x=E),I<f&&(f=I),I>w&&(w=I)}if(S!=Number.MAX_VALUE)if(S<i&&(i=S),f<s&&(s=f),x>o&&(o=x),w>u&&(u=w),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const L=o-i,E=u-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=L,e._allClippedDrawRect.height=E}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(t){return this._channelColors.at(t)}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}}let we;const Zo=10;class Fa{constructor(){this._shaderSets=new A}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(t,e,i){t.isPremultipliedAlpha()||lt("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let s,o,u,c;const h=t.getClippingContextBufferForDraw()!=null,d=e.getDrawableInvertedMaskBit(i),_=h?d?2:1:0;let y;switch(e.getDrawableBlendMode(i)){case ae.CubismBlendMode_Normal:default:y=this._shaderSets.at(1+_),s=this.gl.ONE,o=this.gl.ONE_MINUS_SRC_ALPHA,u=this.gl.ONE,c=this.gl.ONE_MINUS_SRC_ALPHA;break;case ae.CubismBlendMode_Additive:y=this._shaderSets.at(4+_),s=this.gl.ONE,o=this.gl.ONE,u=this.gl.ZERO,c=this.gl.ONE;break;case ae.CubismBlendMode_Multiplicative:y=this._shaderSets.at(7+_),s=this.gl.DST_COLOR,o=this.gl.ONE_MINUS_SRC_ALPHA,u=this.gl.ZERO,c=this.gl.ONE;break}this.gl.useProgram(y.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const S=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,S,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(y.attributePositionLocation),this.gl.vertexAttribPointer(y.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const f=e.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,f,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(y.attributeTexCoordLocation),this.gl.vertexAttribPointer(y.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),h){this.gl.activeTexture(this.gl.TEXTURE1);const j=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,j),this.gl.uniform1i(y.samplerTexture1Location,1),this.gl.uniformMatrix4fv(y.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const R=t.getClippingContextBufferForDraw()._layoutChannelIndex,J=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(R);this.gl.uniform4f(y.uniformChannelFlagLocation,J.r,J.g,J.b,J.a)}const x=e.getDrawableTextureIndex(i),w=t.getBindedTextures().getValue(x);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,w),this.gl.uniform1i(y.samplerTexture0Location,0);const b=t.getMvpMatrix();this.gl.uniformMatrix4fv(y.uniformMatrixLocation,!1,b.getArray());const L=t.getModelColorWithOpacity(e.getDrawableOpacity(i)),E=e.getMultiplyColor(i),I=e.getScreenColor(i);this.gl.uniform4f(y.uniformBaseColorLocation,L.r,L.g,L.b,L.a),this.gl.uniform4f(y.uniformMultiplyColorLocation,E.r,E.g,E.b,E.a),this.gl.uniform4f(y.uniformScreenColorLocation,I.r,I.g,I.b,I.a),t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const X=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,X,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(s,o,u,c)}setupShaderProgramForMask(t,e,i){t.isPremultipliedAlpha()||lt("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();const s=this._shaderSets.at(0);this.gl.useProgram(s.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const o=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributePositionLocation),this.gl.vertexAttribPointer(s.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const u=e.getDrawableTextureIndex(i),c=t.getBindedTextures().getValue(u);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.uniform1i(s.samplerTexture0Location,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const h=e.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,h,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(s.attributeTexCoordLocation),this.gl.vertexAttribPointer(s.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),t.getClippingContextBufferForMask();const d=t.getClippingContextBufferForMask()._layoutChannelIndex,_=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(d);this.gl.uniform4f(s.uniformChannelFlagLocation,_.r,_.g,_.b,_.a),this.gl.uniformMatrix4fv(s.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const y=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(s.uniformBaseColorLocation,y.x*2-1,y.y*2-1,y.getRight()*2-1,y.getBottom()*2-1);const S=e.getMultiplyColor(i),f=e.getScreenColor(i);this.gl.uniform4f(s.uniformMultiplyColorLocation,S.r,S.g,S.b,S.a),this.gl.uniform4f(s.uniformScreenColorLocation,f.r,f.g,f.b,f.a);const x=this.gl.ZERO,w=this.gl.ONE_MINUS_SRC_COLOR,b=this.gl.ZERO,L=this.gl.ONE_MINUS_SRC_ALPHA;t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const E=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,E,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(x,w,b,L)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Zo;t++)this._shaderSets.pushBack(new Ia);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(Qo,tl),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(el,il),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Ds,rl),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Ds,sl),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return lt("Vertex shader compile error!"),0;let o=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return o?(this.gl.attachShader(i,s),this.gl.attachShader(i,o),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(o),i):(lt("Failed to link program: {0}",i),this.gl.deleteShader(s),s=0,this.gl.deleteShader(o),o=0,i&&(this.gl.deleteProgram(i),i=0),0)):(lt("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const u=this.gl.getShaderInfoLog(s);lt("Shader compile log: {0} ",u)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}class pe{static getInstance(){return we==null&&(we=new pe),we}static deleteInstance(){we&&(we.release(),we=null)}constructor(){this._shaderMap=new Tt}release(){for(const t=this._shaderMap.begin();t.notEqual(this._shaderMap.end());t.preIncrement())t.ptr().second.release();this._shaderMap.clear()}getShader(t){return this._shaderMap.getValue(t)}setGlContext(t){if(!this._shaderMap.isExist(t)){const e=new Fa;e.setGl(t),this._shaderMap.setValue(t,e)}}}class Ia{}var Va=(a=>(a[a.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",a[a.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",a[a.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",a[a.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",a[a.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",a[a.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",a[a.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",a[a.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",a[a.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",a[a.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",a))(Va||{});const Qo="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",tl="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",el="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ds="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",il="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",rl="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",sl="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";var ks;(a=>{a.CubismShaderSet=Ia,a.CubismShader_WebGL=Fa,a.CubismShaderManager_WebGL=pe,a.ShaderNames=Va})(ks||(ks={}));let Zt,wi;class ir extends Ko{getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new A,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new A;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wi),this._maskTexture=new Ra(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}constructor(){super(Ta)}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const o=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,o),o._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new A(this._renderTextureCount));for(let s=0;s<this._clearedFrameBufferFlags.getSize();s++)this._clearedFrameBufferFlags.set(s,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){const o=this._clippingContextListForMask.at(s),u=o._allClippedDrawRect,c=o._layoutBounds,h=.05;let d=0,_=0;const y=this.getMaskRenderTexture().at(o._bufferIndex);this._currentMaskRenderTexture!=y&&(this._currentMaskRenderTexture=y,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(u),this._tmpBoundsOnModel.expand(u.width*h,u.height*h),d=c.width/this._tmpBoundsOnModel.width,_=c.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(c.x,c.y),this._tmpMatrix.scaleRelative(d,_),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(c.x,c.y),this._tmpMatrix.scaleRelative(d,_),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),o._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),o._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const S=o._clippingIdCount;for(let f=0;f<S;f++){const x=o._clippingIdList[f];t.getDrawableDynamicFlagVertexPositionsDidChange(x)&&(e.setIsCulling(t.getDrawableCulling(x)!=!1),this._clearedFrameBufferFlags.at(o._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(o._bufferIndex,!0)),e.setClippingContextBufferForMask(o),e.drawMeshWebGL(t,x))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wi),e.setClippingContextBufferForMask(null),this.gl.viewport(Zt[0],Zt[1],Zt[2],Zt[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Ra{constructor(t,e){this.frameNo=t,this.textures=e}}class Ta extends dn{constructor(t,e,i){super(e,i),this._owner=t}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class al{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class lr extends Fi{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new ir,this._clippingManager.initialize(t,e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new ir,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new al,this.firstDraw=!0,this._textures=new Tt,this._sortedDrawableIndexList=new A,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const s=e[i];this._sortedDrawableIndexList.set(s,i)}for(let i=0;i<t;++i){const s=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(s))continue;const o=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(s):null;if(o!=null&&this.isUsingHighPrecisionMask()){o._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,o.getClippingManager().getMaskRenderTexture().at(o._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const u=o._clippingIdCount;for(let c=0;c<u;c++){const h=o._clippingIdList[c];this._model.getDrawableDynamicFlagVertexPositionsDidChange(h)&&(this.setIsCulling(this._model.getDrawableCulling(h)!=!1),this.setClippingContextBufferForMask(o),this.drawMeshWebGL(this._model,h))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wi),this.setClippingContextBufferForMask(null),this.gl.viewport(Zt[0],Zt[1],Zt[2],Zt[3]),this.preDraw()}this.setClippingContextBufferForDraw(o),this.setIsCulling(this.getModel().getDrawableCulling(s)),this.drawMeshWebGL(this._model,s)}}drawMeshWebGL(t,e){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?pe.getInstance().getShader(this.gl).setupShaderProgramForMask(this,t,e):pe.getInstance().getShader(this.gl).setupShaderProgramForDraw(this,t,e);{const i=t.getDrawableVertexIndexCount(e);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){pe.deleteInstance()}setRenderState(t,e){wi=t,Zt=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return this.getClippingContextBufferForMask()!=null}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),pe.getInstance().setGlContext(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}Fi.staticRelease=()=>{lr.doStaticRelease()};var Ns;(a=>{a.CubismClippingContext=Ta,a.CubismClippingManager_WebGL=ir,a.CubismRenderTextureResource=Ra,a.CubismRenderer_WebGL=lr})(Ns||(Ns={}));class nl{constructor(t=!1,e=!1){this.isOverridden=t,this.isParameterRepeated=e}}class Us{constructor(t=!1,e=new Rt){this.isOverridden=t,this.color=e}get isOverwritten(){return this.isOverridden}}class zs{constructor(t=!1,e=new Rt){this.isOverridden=t,this.color=e}get isOverwritten(){return this.isOverridden}}class ol{constructor(t=!1,e=!1){this.isOverridden=t,this.isCulling=e}get isOverwritten(){return this.isOverridden}}class Ea{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverrideFlagForModelMultiplyColors()||this.getOverrideFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverrideFlagForModelScreenColors()||this.getOverrideFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setMultiplyColorByRGBA(t,e,i,s,o=1){this._userMultiplyColors.at(t).color.r=e,this._userMultiplyColors.at(t).color.g=i,this._userMultiplyColors.at(t).color.b=s,this._userMultiplyColors.at(t).color.a=o}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setScreenColorByRGBA(t,e,i,s,o=1){this._userScreenColors.at(t).color.r=e,this._userScreenColors.at(t).color.g=i,this._userScreenColors.at(t).color.b=s,this._userScreenColors.at(t).color.a=o}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).color}getPartScreenColor(t){return this._userPartScreenColors.at(t).color}setPartColor(t,e,i,s,o,u,c){if(u.at(t).color.r=e,u.at(t).color.g=i,u.at(t).color.b=s,u.at(t).color.a=o,u.at(t).isOverridden)for(let h=0;h<this._partChildDrawables.at(t).getSize();++h){const d=this._partChildDrawables.at(t).at(h);c.at(d).color.r=e,c.at(d).color.g=i,c.at(d).color.b=s,c.at(d).color.a=o}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartMultiplyColorByRGBA(t,e,i,s,o){this.setPartColor(t,e,i,s,o,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartScreenColorByRGBA(t,e,i,s,o){this.setPartColor(t,e,i,s,o,this._userPartScreenColors,this._userScreenColors)}getOverrideFlagForModelParameterRepeat(){return this._isOverriddenParameterRepeat}setOverrideFlagForModelParameterRepeat(t){this._isOverriddenParameterRepeat=t}getOverrideFlagForParameterRepeat(t){return this._userParameterRepeatDataList.at(t).isOverridden}setOverrideFlagForParameterRepeat(t,e){this._userParameterRepeatDataList.at(t).isOverridden=e}getRepeatFlagForParameterRepeat(t){return this._userParameterRepeatDataList.at(t).isParameterRepeated}setRepeatFlagForParameterRepeat(t,e){this._userParameterRepeatDataList.at(t).isParameterRepeated=e}getOverwriteFlagForModelMultiplyColors(){return ot("getOverwriteFlagForModelMultiplyColors() is a deprecated function. Please use getOverrideFlagForModelMultiplyColors()."),this.getOverrideFlagForModelMultiplyColors()}getOverrideFlagForModelMultiplyColors(){return this._isOverriddenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return ot("getOverwriteFlagForModelScreenColors() is a deprecated function. Please use getOverrideFlagForModelScreenColors()."),this.getOverrideFlagForModelScreenColors()}getOverrideFlagForModelScreenColors(){return this._isOverriddenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){ot("setOverwriteFlagForModelMultiplyColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelMultiplyColors(value: boolean)."),this.setOverrideFlagForModelMultiplyColors(t)}setOverrideFlagForModelMultiplyColors(t){this._isOverriddenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){ot("setOverwriteFlagForModelScreenColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelScreenColors(value: boolean)."),this.setOverrideFlagForModelScreenColors(t)}setOverrideFlagForModelScreenColors(t){this._isOverriddenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return ot("getOverwriteFlagForDrawableMultiplyColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableMultiplyColors(drawableindex: number)."),this.getOverrideFlagForDrawableMultiplyColors(t)}getOverrideFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverridden}getOverwriteFlagForDrawableScreenColors(t){return ot("getOverwriteFlagForDrawableScreenColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableScreenColors(drawableindex: number)."),this.getOverrideFlagForDrawableScreenColors(t)}getOverrideFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverridden}setOverwriteFlagForDrawableMultiplyColors(t,e){ot("setOverwriteFlagForDrawableMultiplyColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableMultiplyColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableMultiplyColors(t,e)}setOverrideFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverridden=e}setOverwriteFlagForDrawableScreenColors(t,e){ot("setOverwriteFlagForDrawableScreenColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableScreenColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableScreenColors(t,e)}setOverrideFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverridden=e}getOverwriteColorForPartMultiplyColors(t){return ot("getOverwriteColorForPartMultiplyColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartMultiplyColors(partIndex: number)."),this.getOverrideColorForPartMultiplyColors(t)}getOverrideColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverridden}getOverwriteColorForPartScreenColors(t){return ot("getOverwriteColorForPartScreenColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartScreenColors(partIndex: number)."),this.getOverrideColorForPartScreenColors(t)}getOverrideColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverridden}setOverwriteColorForPartColors(t,e,i,s){ot("setOverwriteColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>) is a deprecated function. Please use setOverrideColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>)."),this.setOverrideColorForPartColors(t,e,i,s)}setOverrideColorForPartColors(t,e,i,s){i.at(t).isOverridden=e;for(let o=0;o<this._partChildDrawables.at(t).getSize();++o){const u=this._partChildDrawables.at(t).at(o);s.at(u).isOverridden=e,e&&(s.at(u).color.r=i.at(t).color.r,s.at(u).color.g=i.at(t).color.g,s.at(u).color.b=i.at(t).color.b,s.at(u).color.a=i.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(t,e){ot("setOverwriteColorForPartMultiplyColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartMultiplyColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartMultiplyColors(t,e)}setOverrideColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverridden=e,this.setOverrideColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){ot("setOverwriteColorForPartScreenColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartScreenColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartScreenColors(t,e)}setOverrideColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverridden=e,this.setOverrideColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverrideFlagForModelCullings()||this.getOverrideFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return ot("getOverwriteFlagForModelCullings() is a deprecated function. Please use getOverrideFlagForModelCullings()."),this.getOverrideFlagForModelCullings()}getOverrideFlagForModelCullings(){return this._isOverriddenCullings}setOverwriteFlagForModelCullings(t){ot("setOverwriteFlagForModelCullings(isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForModelCullings(isOverriddenCullings: boolean)."),this.setOverrideFlagForModelCullings(t)}setOverrideFlagForModelCullings(t){this._isOverriddenCullings=t}getOverwriteFlagForDrawableCullings(t){return ot("getOverwriteFlagForDrawableCullings(drawableIndex: number) is a deprecated function. Please use getOverrideFlagForDrawableCullings(drawableIndex: number)."),this.getOverrideFlagForDrawableCullings(t)}getOverrideFlagForDrawableCullings(t){return this._userCullings.at(t).isOverridden}setOverwriteFlagForDrawableCullings(t,e){ot("setOverwriteFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean)."),this.setOverrideFlagForDrawableCullings(t,e)}setOverrideFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverridden=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return Z.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}getPartParentPartIndices(){return this._model.parts.parentIndices}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}It(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(It(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterId(t){return Z.getIdManager().getId(this._model.parameters.ids[t])}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(It(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}It(0<=t&&t<this.getParameterCount()),this.isRepeat(t)?e=this.getParameterRepeatValue(t,e):e=this.getParameterClampValue(t,e),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}isRepeat(t){if(this._notExistParameterValues.isExist(t))return!1;It(0<=t&&t<this.getParameterCount());let e;return this._isOverriddenParameterRepeat||this._userParameterRepeatDataList.at(t).isOverridden?e=this._userParameterRepeatDataList.at(t).isParameterRepeated:e=this._model.parameters.repeats[t]!=0,e}getParameterRepeatValue(t,e){if(this._notExistParameterValues.isExist(t))return e;It(0<=t&&t<this.getParameterCount());const i=this._model.parameters.maximumValues[t],s=this._model.parameters.minimumValues[t],o=i-s;if(i<e){const u=z.mod(e-i,o);Number.isNaN(u)?e=i:e=s+u}if(e<s){const u=z.mod(s-e,o);Number.isNaN(u)?e=s:e=i-u}return e}getParameterClampValue(t,e){if(this._notExistParameterValues.isExist(t))return e;It(0<=t&&t<this.getParameterCount());const i=this._model.parameters.maximumValues[t],s=this._model.parameters.minimumValues[t];return z.clamp(e,s,i)}getParameterRepeats(t){return this._model.parameters.repeats[t]!=0}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return Z.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,s=new Rt;return s.r=e[i],s.g=e[i+1],s.b=e[i+2],s.a=e[i+3],s}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,s=new Rt;return s.r=e[i],s.g=e[i+1],s.b=e[i+2],s.a=e[i+3],s}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?ae.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?ae.CubismBlendMode_Multiplicative:ae.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){It(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i),this._userParameterRepeatDataList.prepareCapacity(i);for(let s=0;s<i;++s)this._parameterIds.pushBack(Z.getIdManager().getId(e[s])),this._userParameterRepeatDataList.pushBack(new nl(!1,!1))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(Z.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const s=new ol(!1,!1);for(let o=0;o<t;++o){const u=new Rt(1,1,1,1),c=new Rt(0,0,0,1),h=new zs(!1,u),d=new zs(!1,c);this._userPartMultiplyColors.pushBack(h),this._userPartScreenColors.pushBack(d),this._partChildDrawables.pushBack(new A),this._partChildDrawables.at(o).prepareCapacity(i)}for(let o=0;o<i;++o){const u=new Rt(1,1,1,1),c=new Rt(0,0,0,1),h=new Us(!1,u),d=new Us(!1,c);this._drawableIds.pushBack(Z.getIdManager().getId(e[o])),this._userMultiplyColors.pushBack(h),this._userScreenColors.pushBack(d),this._userCullings.pushBack(s);const _=this.getDrawableParentPartIndex(o);_>=0&&this._partChildDrawables.at(_).pushBack(o)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new A,this._parameterIds=new A,this._drawableIds=new A,this._partIds=new A,this._isOverriddenParameterRepeat=!0,this._isOverriddenModelMultiplyColors=!1,this._isOverriddenModelScreenColors=!1,this._isOverriddenCullings=!1,this._modelOpacity=1,this._userParameterRepeatDataList=new A,this._userMultiplyColors=new A,this._userScreenColors=new A,this._userCullings=new A,this._userPartMultiplyColors=new A,this._userPartScreenColors=new A,this._partChildDrawables=new A,this._notExistPartId=new Tt,this._notExistParameterId=new Tt,this._notExistParameterValues=new Tt,this._notExistPartOpacities=new Tt}release(){this._model.release(),this._model=null}}var js;(a=>{a.CubismModel=Ea})(js||(js={}));class si{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return lt("Inconsistent MOC3."),i;const s=Live2DCubismCore.Moc.fromArrayBuffer(t);return s&&(i=new si(s),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(s,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new Ea(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){It(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var Xs;(a=>{a.CubismMoc=si})(Xs||(Xs={}));const Gs="Meta",ll="UserDataCount",ul="TotalUserDataSize",$i="UserData",hl="Target",cl="Id",gl="Value";class Aa{constructor(t,e){this._json=Mt.create(t,e)}release(){Mt.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(Gs).getValueByString(ll).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(Gs).getValueByString(ul).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString($i).getValueByIndex(t).getValueByString(hl).getRawString()}getUserDataId(t){return Z.getIdManager().getId(this._json.getRoot().getValueByString($i).getValueByIndex(t).getValueByString(cl).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString($i).getValueByIndex(t).getValueByString(gl).getRawString()}}var Ys;(a=>{a.CubismModelUserDataJson=Aa})(Ys||(Ys={}));const dl="ArtMesh";class La{}class ei{static create(t,e){const i=new ei;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new Aa(t,e);if(!i){i.release(),i=void 0;return}const s=Z.getIdManager().getId(dl),o=i.getUserDataCount();for(let u=0;u<o;u++){const c=new La;c.targetId=i.getUserDataId(u),c.targetType=Z.getIdManager().getId(i.getUserDataTargetType(u)),c.value=new kt(i.getUserDataValue(u)),this._userDataNodes.pushBack(c),c.targetType==s&&this._artMeshUserDataNode.pushBack(c)}i.release(),i=void 0}constructor(){this._userDataNodes=new A,this._artMeshUserDataNode=new A}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var Hs;(a=>{a.CubismModelUserData=ei,a.CubismModelUserDataNode=La})(Hs||(Hs={}));class Vi{isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){if(this._moc=si.create(t,e),this._moc==null){lt("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){lt("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new aa(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadMotion(t,e,i,s,o,u,c,h,d=!1){if(t==null||e==0)return lt("Failed to loadMotion()."),null;const _=Ii.create(t,e,s,o,d);if(_==null)return lt("Failed to create motion from buffer in LoadMotion()"),null;if(u){const y=u.getMotionFadeInTimeValue(c,h);y>=0&&_.setFadeInTime(y);const S=u.getMotionFadeOutTimeValue(c,h);S>=0&&_.setFadeOutTime(S)}return _}loadExpression(t,e,i){return t==null||e==0?(lt("Failed to loadExpression()."),null):se.create(t,e)}loadPose(t,e){if(t==null||e==0){lt("Failed to loadPose().");return}this._pose=Ke.create(t,e)}loadUserData(t,e){if(t==null||e==0){lt("Failed to loadUserData().");return}this._modelUserData=ei.create(t,e)}loadPhysics(t,e){if(t==null||e==0){lt("Failed to loadPhysics().");return}this._physics=ti.create(t,e)}isHit(t,e,i){const s=this._model.getDrawableIndex(t);if(s<0)return!1;const o=this._model.getDrawableVertexCount(s),u=this._model.getDrawableVertices(s);let c=u[0],h=u[0],d=u[1],_=u[1];for(let f=1;f<o;++f){const x=u[re.vertexOffset+f*re.vertexStep],w=u[re.vertexOffset+f*re.vertexStep+1];x<c&&(c=x),x>h&&(h=x),w<d&&(d=w),w>_&&(_=w)}const y=this._modelMatrix.invertTransformX(e),S=this._modelMatrix.invertTransformY(i);return c<=y&&y<=h&&d<=S&&S<=_}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new lr,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){Vt("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const s=i;s!=null&&s.motionEventFired(e)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new xa,this._motionManager.setEventCallback(Vi.cubismDefaultMotionEventCallback,this),this._expressionManager=new ha,this._dragManager=new na}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Ke.delete(this._pose),qe.delete(this._eyeBlink),ri.delete(this._breath),this._dragManager=null,ti.delete(this._physics),ei.delete(this._modelUserData),this.deleteRenderer()}}var Ws;(a=>{a.CubismUserModel=Vi})(Ws||(Ws={}));let Be=null;class ur{constructor(){this.loadFiletoBytes=(t,e)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=e},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new _l,this._byteReader=new fl}static getInstance(){return Be==null&&(Be=new ur),Be}static releaseInstance(){Be!=null&&(Be=void 0),Be=null}update(t){let e,i;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,e=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),e>this._wavFileInfo._samplesPerChannel&&(e=this._wavFileInfo._samplesPerChannel),i=0;for(let s=0;s<this._wavFileInfo._numberOfChannels;s++)for(let o=this._sampleOffset;o<e;o++){const u=this._pcmData[s][o];i+=u*u}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(e-this._sampleOffset))),this._lastRms=i,this._sampleOffset=e,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){return new Promise(e=>{let i=!1;this._pcmData!=null&&this.releasePcmData();const s=async()=>fetch(t).then(o=>o.arrayBuffer());(async()=>{if(this._byteReader._fileByte=await s(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4){e(!1);return}this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,new Error('Cannot find Signeture "fmt".');const o=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw i=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),o>16&&(this._byteReader._readOffset+=o-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,new Error('Cannot find "data" Chunk.');{const u=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=u*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let u=0;u<this._wavFileInfo._numberOfChannels;u++)this._pcmData[u]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let u=0;u<this._wavFileInfo._samplesPerChannel;u++)for(let c=0;c<this._wavFileInfo._numberOfChannels;c++)this._pcmData[c][u]=this.getPcmSample();i=!0,e(i)}catch(o){console.log(o)}})().then(()=>{e(i)})})}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}getPcmDataChannel(t){return!this._pcmData||!(t<this._pcmData.length)?null:Float32Array.from(this._pcmData[t])}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)this._pcmData[t]=null;delete this._pcmData,this._pcmData=null}}class _l{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class fl{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let s=0;s<4;s++)e[s]=this.get8();return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]}}var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ji={},$s;function ml(){return $s||($s=1,(function(){var a;function t(r){var n=0;return function(){return n<r.length?{done:!1,value:r[n++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(r,n,l){return r==Array.prototype||r==Object.prototype||(r[n]=l.value),r};function i(r){r=[typeof globalThis=="object"&&globalThis,r,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var n=0;n<r.length;++n){var l=r[n];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var s=i(this);function o(r,n){if(n)t:{var l=s;r=r.split(".");for(var g=0;g<r.length-1;g++){var m=r[g];if(!(m in l))break t;l=l[m]}r=r[r.length-1],g=l[r],n=n(g),n!=g&&n!=null&&e(l,r,{configurable:!0,writable:!0,value:n})}}o("Symbol",function(r){function n(C){if(this instanceof n)throw new TypeError("Symbol is not a constructor");return new l(g+(C||"")+"_"+m++,C)}function l(C,p){this.g=C,e(this,"description",{configurable:!0,writable:!0,value:p})}if(r)return r;l.prototype.toString=function(){return this.g};var g="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",m=0;return n}),o("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),l=0;l<n.length;l++){var g=s[n[l]];typeof g=="function"&&typeof g.prototype[r]!="function"&&e(g.prototype,r,{configurable:!0,writable:!0,value:function(){return u(t(this))}})}return r});function u(r){return r={next:r},r[Symbol.iterator]=function(){return this},r}function c(r){var n=typeof Symbol<"u"&&Symbol.iterator&&r[Symbol.iterator];return n?n.call(r):{next:t(r)}}function h(r){if(!(r instanceof Array)){r=c(r);for(var n,l=[];!(n=r.next()).done;)l.push(n.value);r=l}return r}var d=typeof Object.create=="function"?Object.create:function(r){function n(){}return n.prototype=r,new n},_;if(typeof Object.setPrototypeOf=="function")_=Object.setPrototypeOf;else{var y;t:{var S={a:!0},f={};try{f.__proto__=S,y=f.a;break t}catch{}y=!1}_=y?function(r,n){if(r.__proto__=n,r.__proto__!==n)throw new TypeError(r+" is not extensible");return r}:null}var x=_;function w(r,n){if(r.prototype=d(n.prototype),r.prototype.constructor=r,x)x(r,n);else for(var l in n)if(l!="prototype")if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(n,l);g&&Object.defineProperty(r,l,g)}else r[l]=n[l];r.ea=n.prototype}function b(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function L(r){if(r.l)throw new TypeError("Generator is already running");r.l=!0}b.prototype.o=function(r){this.h=r};function E(r,n){r.j={U:n,V:!0},r.g=r.m||r.s}b.prototype.return=function(r){this.j={return:r},this.g=this.s};function I(r,n,l){return r.g=l,{value:n}}function X(r){this.g=new b,this.h=r}function j(r,n){L(r.g);var l=r.g.i;return l?R(r,"return"in l?l.return:function(g){return{value:g,done:!0}},n,r.g.return):(r.g.return(n),J(r))}function R(r,n,l,g){try{var m=n.call(r.g.i,l);if(!(m instanceof Object))throw new TypeError("Iterator result "+m+" is not an object");if(!m.done)return r.g.l=!1,m;var C=m.value}catch(p){return r.g.i=null,E(r.g,p),J(r)}return r.g.i=null,g.call(r.g,C),J(r)}function J(r){for(;r.g.g;)try{var n=r.h(r.g);if(n)return r.g.l=!1,{value:n.value,done:!1}}catch(l){r.g.h=void 0,E(r.g,l)}if(r.g.l=!1,r.g.j){if(n=r.g.j,r.g.j=null,n.V)throw n.U;return{value:n.return,done:!0}}return{value:void 0,done:!0}}function gt(r){this.next=function(n){return L(r.g),r.g.i?n=R(r,r.g.i.next,n,r.g.o):(r.g.o(n),n=J(r)),n},this.throw=function(n){return L(r.g),r.g.i?n=R(r,r.g.i.throw,n,r.g.o):(E(r.g,n),n=J(r)),n},this.return=function(n){return j(r,n)},this[Symbol.iterator]=function(){return this}}function st(r,n){return n=new gt(new X(n)),x&&r.prototype&&x(n,r.prototype),n}function v(r,n){r instanceof String&&(r+="");var l=0,g=!1,m={next:function(){if(!g&&l<r.length){var C=l++;return{value:n(C,r[C]),done:!1}}return g=!0,{done:!0,value:void 0}}};return m[Symbol.iterator]=function(){return m},m}var P=typeof Object.assign=="function"?Object.assign:function(r,n){for(var l=1;l<arguments.length;l++){var g=arguments[l];if(g)for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(r[m]=g[m])}return r};o("Object.assign",function(r){return r||P}),o("Promise",function(r){function n(p){this.h=0,this.i=void 0,this.g=[],this.o=!1;var M=this.j();try{p(M.resolve,M.reject)}catch(B){M.reject(B)}}function l(){this.g=null}function g(p){return p instanceof n?p:new n(function(M){M(p)})}if(r)return r;l.prototype.h=function(p){if(this.g==null){this.g=[];var M=this;this.i(function(){M.l()})}this.g.push(p)};var m=s.setTimeout;l.prototype.i=function(p){m(p,0)},l.prototype.l=function(){for(;this.g&&this.g.length;){var p=this.g;this.g=[];for(var M=0;M<p.length;++M){var B=p[M];p[M]=null;try{B()}catch(V){this.j(V)}}}this.g=null},l.prototype.j=function(p){this.i(function(){throw p})},n.prototype.j=function(){function p(V){return function(G){B||(B=!0,V.call(M,G))}}var M=this,B=!1;return{resolve:p(this.C),reject:p(this.l)}},n.prototype.C=function(p){if(p===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(p instanceof n)this.F(p);else{t:switch(typeof p){case"object":var M=p!=null;break t;case"function":M=!0;break t;default:M=!1}M?this.u(p):this.m(p)}},n.prototype.u=function(p){var M=void 0;try{M=p.then}catch(B){this.l(B);return}typeof M=="function"?this.G(M,p):this.m(p)},n.prototype.l=function(p){this.s(2,p)},n.prototype.m=function(p){this.s(1,p)},n.prototype.s=function(p,M){if(this.h!=0)throw Error("Cannot settle("+p+", "+M+"): Promise already settled in state"+this.h);this.h=p,this.i=M,this.h===2&&this.D(),this.A()},n.prototype.D=function(){var p=this;m(function(){if(p.B()){var M=s.console;typeof M<"u"&&M.error(p.i)}},1)},n.prototype.B=function(){if(this.o)return!1;var p=s.CustomEvent,M=s.Event,B=s.dispatchEvent;return typeof B>"u"?!0:(typeof p=="function"?p=new p("unhandledrejection",{cancelable:!0}):typeof M=="function"?p=new M("unhandledrejection",{cancelable:!0}):(p=s.document.createEvent("CustomEvent"),p.initCustomEvent("unhandledrejection",!1,!0,p)),p.promise=this,p.reason=this.i,B(p))},n.prototype.A=function(){if(this.g!=null){for(var p=0;p<this.g.length;++p)C.h(this.g[p]);this.g=null}};var C=new l;return n.prototype.F=function(p){var M=this.j();p.J(M.resolve,M.reject)},n.prototype.G=function(p,M){var B=this.j();try{p.call(M,B.resolve,B.reject)}catch(V){B.reject(V)}},n.prototype.then=function(p,M){function B(q,H){return typeof q=="function"?function(O){try{V(q(O))}catch(Y){G(Y)}}:H}var V,G,ht=new n(function(q,H){V=q,G=H});return this.J(B(p,V),B(M,G)),ht},n.prototype.catch=function(p){return this.then(void 0,p)},n.prototype.J=function(p,M){function B(){switch(V.h){case 1:p(V.i);break;case 2:M(V.i);break;default:throw Error("Unexpected state: "+V.h)}}var V=this;this.g==null?C.h(B):this.g.push(B),this.o=!0},n.resolve=g,n.reject=function(p){return new n(function(M,B){B(p)})},n.race=function(p){return new n(function(M,B){for(var V=c(p),G=V.next();!G.done;G=V.next())g(G.value).J(M,B)})},n.all=function(p){var M=c(p),B=M.next();return B.done?g([]):new n(function(V,G){function ht(O){return function(Y){q[O]=Y,H--,H==0&&V(q)}}var q=[],H=0;do q.push(void 0),H++,g(B.value).J(ht(q.length-1),G),B=M.next();while(!B.done)})},n}),o("Object.is",function(r){return r||function(n,l){return n===l?n!==0||1/n===1/l:n!==n&&l!==l}}),o("Array.prototype.includes",function(r){return r||function(n,l){var g=this;g instanceof String&&(g=String(g));var m=g.length;for(l=l||0,0>l&&(l=Math.max(l+m,0));l<m;l++){var C=g[l];if(C===n||Object.is(C,n))return!0}return!1}}),o("String.prototype.includes",function(r){return r||function(n,l){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(n instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(n,l||0)!==-1}}),o("Array.prototype.keys",function(r){return r||function(){return v(this,function(n){return n})}});var k=this||self;function T(r,n){r=r.split(".");var l=k;r[0]in l||typeof l.execScript>"u"||l.execScript("var "+r[0]);for(var g;r.length&&(g=r.shift());)r.length||n===void 0?l[g]&&l[g]!==Object.prototype[g]?l=l[g]:l=l[g]={}:l[g]=n}function ut(r,n){return n=String.fromCharCode.apply(null,n),r==null?n:r+n}var vt,F=typeof TextDecoder<"u",U,et=typeof TextEncoder<"u";function _t(r){if(et)r=(U||(U=new TextEncoder)).encode(r);else{var n=void 0;n=n===void 0?!1:n;for(var l=0,g=new Uint8Array(3*r.length),m=0;m<r.length;m++){var C=r.charCodeAt(m);if(128>C)g[l++]=C;else{if(2048>C)g[l++]=C>>6|192;else{if(55296<=C&&57343>=C){if(56319>=C&&m<r.length){var p=r.charCodeAt(++m);if(56320<=p&&57343>=p){C=1024*(C-55296)+p-56320+65536,g[l++]=C>>18|240,g[l++]=C>>12&63|128,g[l++]=C>>6&63|128,g[l++]=C&63|128;continue}else m--}if(n)throw Error("Found an unpaired surrogate");C=65533}g[l++]=C>>12|224,g[l++]=C>>6&63|128}g[l++]=C&63|128}}r=g.subarray(0,l)}return r}var Pt={},Nt=null;function Et(r,n){n===void 0&&(n=0),Qt(),n=Pt[n];for(var l=Array(Math.floor(r.length/3)),g=n[64]||"",m=0,C=0;m<r.length-2;m+=3){var p=r[m],M=r[m+1],B=r[m+2],V=n[p>>2];p=n[(p&3)<<4|M>>4],M=n[(M&15)<<2|B>>6],B=n[B&63],l[C++]=V+p+M+B}switch(V=0,B=g,r.length-m){case 2:V=r[m+1],B=n[(V&15)<<2]||g;case 1:r=r[m],l[C]=n[r>>2]+n[(r&3)<<4|V>>4]+B+g}return l.join("")}function Ut(r){var n=r.length,l=3*n/4;l%3?l=Math.floor(l):"=.".indexOf(r[n-1])!=-1&&(l="=.".indexOf(r[n-2])!=-1?l-2:l-1);var g=new Uint8Array(l),m=0;return ne(r,function(C){g[m++]=C}),g.subarray(0,m)}function ne(r,n){function l(B){for(;g<r.length;){var V=r.charAt(g++),G=Nt[V];if(G!=null)return G;if(!/^[\s\xa0]*$/.test(V))throw Error("Unknown base64 encoding at char: "+V)}return B}Qt();for(var g=0;;){var m=l(-1),C=l(0),p=l(64),M=l(64);if(M===64&&m===-1)break;n(m<<2|C>>4),p!=64&&(n(C<<4&240|p>>2),M!=64&&n(p<<6&192|M))}}function Qt(){if(!Nt){Nt={};for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),n=["+/=","+/","-_=","-_.","-_"],l=0;5>l;l++){var g=r.concat(n[l].split(""));Pt[l]=g;for(var m=0;m<g.length;m++){var C=g[m];Nt[C]===void 0&&(Nt[C]=m)}}}}var Ri=typeof Uint8Array.prototype.slice=="function",ai;function ni(r,n,l){return n===l?ai||(ai=new Uint8Array(0)):Ri?r.slice(n,l):new Uint8Array(r.subarray(n,l))}var zt=0,Ht=0;function oe(r,n){n=n===void 0?{}:n,n=n.v===void 0?!1:n.v,this.h=null,this.g=this.j=this.l=0,this.m=!1,this.v=n,r&&oi(this,r)}function oi(r,n){n=n.constructor===Uint8Array?n:n.constructor===ArrayBuffer?new Uint8Array(n):n.constructor===Array?new Uint8Array(n):n.constructor===String?Ut(n):n instanceof Uint8Array?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(0),r.h=n,r.l=0,r.j=r.h.length,r.g=r.l}oe.prototype.reset=function(){this.g=this.l};function bt(r){for(var n=128,l=0,g=0,m=0;4>m&&128<=n;m++)n=r.h[r.g++],l|=(n&127)<<7*m;if(128<=n&&(n=r.h[r.g++],l|=(n&127)<<28,g|=(n&127)>>4),128<=n)for(m=0;5>m&&128<=n;m++)n=r.h[r.g++],g|=(n&127)<<7*m+3;if(128>n)return r=l>>>0,n=g>>>0,(g=n&2147483648)&&(r=~r+1>>>0,n=~n>>>0,r==0&&(n=n+1>>>0)),r=4294967296*n+(r>>>0),g?-r:r;r.m=!0}oe.prototype.i=function(){var r=this.h,n=r[this.g],l=n&127;return 128>n?(this.g+=1,l):(n=r[this.g+1],l|=(n&127)<<7,128>n?(this.g+=2,l):(n=r[this.g+2],l|=(n&127)<<14,128>n?(this.g+=3,l):(n=r[this.g+3],l|=(n&127)<<21,128>n?(this.g+=4,l):(n=r[this.g+4],l|=(n&15)<<28,128>n?(this.g+=5,l>>>0):(this.g+=5,128<=r[this.g++]&&128<=r[this.g++]&&128<=r[this.g++]&&128<=r[this.g++]&&this.g++,l)))))},oe.prototype.o=function(){var r=this.h[this.g],n=this.h[this.g+1],l=this.h[this.g+2],g=this.h[this.g+3];return this.g+=4,l=(r<<0|n<<8|l<<16|g<<24)>>>0,r=2*(l>>31)+1,n=l>>>23&255,l&=8388607,n==255?l?NaN:1/0*r:n==0?r*Math.pow(2,-149)*l:r*Math.pow(2,n-150)*(l+Math.pow(2,23))};var hr=[];function li(){this.g=new Uint8Array(64),this.h=0}li.prototype.push=function(r){if(!(this.h+1<this.g.length)){var n=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(n)}this.g[this.h++]=r},li.prototype.length=function(){return this.h},li.prototype.end=function(){var r=this.g,n=this.h;return this.h=0,ni(r,0,n)};function te(r,n){for(;127<n;)r.push(n&127|128),n>>>=7;r.push(n)}function De(r){var n={},l=n.N===void 0?!1:n.N;this.o={v:n.v===void 0?!1:n.v},this.N=l,n=this.o,hr.length?(l=hr.pop(),n&&(l.v=n.v),r&&oi(l,r),r=l):r=new oe(r,n),this.g=r,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}De.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};function Jt(r){var n=r.g;if((n=n.g==n.j)||(n=r.j)||(n=r.g,n=n.m||0>n.g||n.g>n.j),n)return!1;r.m=r.g.g,n=r.g.i();var l=n&7;return l!=0&&l!=5&&l!=1&&l!=2&&l!=3&&l!=4?(r.j=!0,!1):(r.i=n,r.l=n>>>3,r.h=l,!0)}function ve(r){switch(r.h){case 0:if(r.h!=0)ve(r);else{for(r=r.g;r.h[r.g]&128;)r.g++;r.g++}break;case 1:r.h!=1?ve(r):(r=r.g,r.g+=8);break;case 2:if(r.h!=2)ve(r);else{var n=r.g.i();r=r.g,r.g+=n}break;case 5:r.h!=5?ve(r):(r=r.g,r.g+=4);break;case 3:n=r.l;do{if(!Jt(r)){r.j=!0;break}if(r.h==4){r.l!=n&&(r.j=!0);break}ve(r)}while(!0);break;default:r.j=!0}}function ui(r,n,l){var g=r.g.j,m=r.g.i(),C=r.g.g+m;if(r.g.j=C,l(n,r),l=C-r.g.g,l!==0)throw Error("Message parsing ended unexpectedly. Expected to read "+m+" bytes, instead read "+(m-l)+" bytes, either the data ended unexpectedly or the message misreported its own length");return r.g.g=C,r.g.j=g,n}function Ot(r){return r.g.o()}function cr(r){var n=r.g.i();r=r.g;var l=r.g;r.g+=n,r=r.h;var g;if(F)(g=vt)||(g=vt=new TextDecoder("utf-8",{fatal:!1})),g=g.decode(r.subarray(l,l+n));else{n=l+n;for(var m=[],C=null,p,M,B;l<n;)p=r[l++],128>p?m.push(p):224>p?l>=n?m.push(65533):(M=r[l++],194>p||(M&192)!==128?(l--,m.push(65533)):m.push((p&31)<<6|M&63)):240>p?l>=n-1?m.push(65533):(M=r[l++],(M&192)!==128||p===224&&160>M||p===237&&160<=M||((g=r[l++])&192)!==128?(l--,m.push(65533)):m.push((p&15)<<12|(M&63)<<6|g&63)):244>=p?l>=n-2?m.push(65533):(M=r[l++],(M&192)!==128||(p<<28)+(M-144)>>30!==0||((g=r[l++])&192)!==128||((B=r[l++])&192)!==128?(l--,m.push(65533)):(p=(p&7)<<18|(M&63)<<12|(g&63)<<6|B&63,p-=65536,m.push((p>>10&1023)+55296,(p&1023)+56320))):m.push(65533),8192<=m.length&&(C=ut(C,m),m.length=0);g=ut(C,m)}return g}function gr(r,n,l){var g=r.g.i();for(g=r.g.g+g;r.g.g<g;)l.push(n.call(r.g))}function dr(r,n){r.h==2?gr(r,oe.prototype.o,n):n.push(Ot(r))}function Ti(){this.h=[],this.i=0,this.g=new li}function xe(r,n){n.length!==0&&(r.h.push(n),r.i+=n.length)}function Ei(r){var n=r.i+r.g.length();if(n===0)return new Uint8Array(0);n=new Uint8Array(n);for(var l=r.h,g=l.length,m=0,C=0;C<g;C++){var p=l[C];p.length!==0&&(n.set(p,m),m+=p.length)}return l=r.g,g=l.h,g!==0&&(n.set(l.g.subarray(0,g),m),l.h=0),r.h=[n],n}function jt(r,n,l){if(l!=null){te(r.g,8*n+5),r=r.g;var g=l;g=(l=0>g?1:0)?-g:g,g===0?0<1/g?zt=Ht=0:(Ht=0,zt=2147483648):isNaN(g)?(Ht=0,zt=2147483647):34028234663852886e22<g?(Ht=0,zt=(l<<31|2139095040)>>>0):11754943508222875e-54>g?(g=Math.round(g/Math.pow(2,-149)),Ht=0,zt=(l<<31|g)>>>0):(n=Math.floor(Math.log(g)/Math.LN2),g*=Math.pow(2,-n),g=Math.round(8388608*g),16777216<=g&&++n,Ht=0,zt=(l<<31|n+127<<23|g&8388607)>>>0),l=zt,r.push(l>>>0&255),r.push(l>>>8&255),r.push(l>>>16&255),r.push(l>>>24&255)}}var _r=typeof Uint8Array=="function";function fr(r,n,l){if(r!=null)return typeof r=="object"?_r&&r instanceof Uint8Array?l(r):mr(r,n,l):n(r)}function mr(r,n,l){if(Array.isArray(r)){for(var g=Array(r.length),m=0;m<r.length;m++)g[m]=fr(r[m],n,l);return Array.isArray(r)&&r.W&&ke(g),g}g={};for(m in r)g[m]=fr(r[m],n,l);return g}function ka(r){return typeof r=="number"?isFinite(r)?r:String(r):r}var Na={W:{value:!0,configurable:!0}};function ke(r){return Array.isArray(r)&&!Object.isFrozen(r)&&Object.defineProperties(r,Na),r}var pr;function St(r,n,l){var g=pr;pr=null,r||(r=g),g=this.constructor.ca,r||(r=g?[g]:[]),this.j=g?0:-1,this.m=this.g=null,this.h=r;t:{if(g=this.h.length,r=g-1,g&&(g=this.h[r],!(g===null||typeof g!="object"||Array.isArray(g)||_r&&g instanceof Uint8Array))){this.l=r-this.j,this.i=g;break t}n!==void 0&&-1<n?(this.l=Math.max(n,r+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(l)for(n=0;n<l.length;n++)r=l[n],r<this.l?(r+=this.j,(g=this.h[r])?ke(g):this.h[r]=hi):(yr(this),(g=this.i[r])?ke(g):this.i[r]=hi)}var hi=Object.freeze(ke([]));function yr(r){var n=r.l+r.j;r.h[n]||(r.i=r.h[n]={})}function ft(r,n,l){return n===-1?null:l!==void 0&&l||n>=r.l?r.i?r.i[n]:void 0:r.h[n+r.j]}function ci(r,n){var l=l===void 0?!1:l,g=ft(r,n,l);return g==null&&(g=hi),g===hi&&(g=ke([]),Q(r,n,g,l)),g}function vr(r){var n=ci(r,3);if(r.m||(r.m={}),!r.m[3]){for(var l=0;l<n.length;l++)n[l]=+n[l];r.m[3]=!0}return n}function le(r,n,l){return r=ft(r,n),r??l}function Wt(r,n,l){return r=ft(r,n),r=r==null?r:+r,r??(l===void 0?0:l)}function Q(r,n,l,g){g!==void 0&&g||n>=r.l?(yr(r),r.i[n]=l):r.h[n+r.j]=l}function xr(r,n,l){if(l===-1)return null;if(r.g||(r.g={}),!r.g[l]){var g=ft(r,l,!1);g&&(r.g[l]=new n(g))}return r.g[l]}function gi(r,n){r.g||(r.g={});var l=r.g[1];if(!l){var g=ci(r,1);l=[];for(var m=0;m<g.length;m++)l[m]=new n(g[m]);r.g[1]=l}return l}function Sr(r,n,l){var g=g===void 0?!1:g;r.g||(r.g={});var m=l&&ue(l);r.g[n]=l,Q(r,n,m,g)}function Cr(r,n,l,g){var m=gi(r,l);n=n||new l,r=ci(r,1),g!=null?(m.splice(g,0,n),r.splice(g,0,ue(n))):(m.push(n),r.push(ue(n)))}St.prototype.toJSON=function(){var r=ue(this);return mr(r,ka,Et)};function ue(r,n){if(r.g)for(var l in r.g){var g=r.g[l];if(Array.isArray(g))for(var m=0;m<g.length;m++)g[m]&&ue(g[m]);else g&&ue(g)}return r.h}St.prototype.toString=function(){return ue(this).toString()};function Ai(r,n){if(r=r.o){xe(n,n.g.end());for(var l=0;l<r.length;l++)xe(n,r[l])}}function ee(r,n){if(n.h==4)return!1;var l=n.m;return ve(n),n.N||(n=ni(n.g.h,l,n.g.g),(l=r.o)?l.push(n):r.o=[n]),!0}function he(r){St.call(this,r,-1,za)}w(he,St),he.prototype.getRows=function(){return ft(this,1)},he.prototype.getCols=function(){return ft(this,2)},he.prototype.getPackedDataList=function(){return vr(this)},he.prototype.getLayout=function(){return le(this,4,0)};function Ua(r,n){for(;Jt(n);)switch(n.i){case 8:var l=n.g.i();Q(r,1,l);break;case 16:l=n.g.i(),Q(r,2,l);break;case 29:case 26:dr(n,r.getPackedDataList());break;case 32:l=bt(n.g),Q(r,4,l);break;default:if(!ee(r,n))return r}return r}var za=[3];function Bt(r,n){var l=void 0;return new(l||(l=Promise))(function(g,m){function C(B){try{M(n.next(B))}catch(V){m(V)}}function p(B){try{M(n.throw(B))}catch(V){m(V)}}function M(B){B.done?g(B.value):new l(function(V){V(B.value)}).then(C,p)}M((n=n.apply(r,void 0)).next())})}function Ne(r){St.call(this,r)}w(Ne,St);function ja(r,n){for(;Jt(n);)switch(n.i){case 8:var l=n.g.i();Q(r,1,l);break;case 21:l=Ot(n),Q(r,2,l);break;case 26:l=cr(n),Q(r,3,l);break;case 34:l=cr(n),Q(r,4,l);break;default:if(!ee(r,n))return r}return r}function Li(r){St.call(this,r,-1,Xa)}w(Li,St),Li.prototype.addClassification=function(r,n){return Cr(this,r,Ne,n),this};var Xa=[1];function Se(r){St.call(this,r)}w(Se,St);function Ga(r,n){for(;Jt(n);)switch(n.i){case 13:var l=Ot(n);Q(r,1,l);break;case 21:l=Ot(n),Q(r,2,l);break;case 29:l=Ot(n),Q(r,3,l);break;case 37:l=Ot(n),Q(r,4,l);break;case 45:l=Ot(n),Q(r,5,l);break;default:if(!ee(r,n))return r}return r}function Mr(r){St.call(this,r,-1,Ya)}w(Mr,St);function Pr(r){t:{var n=new Mr;for(r=new De(r);Jt(r);)switch(r.i){case 10:var l=ui(r,new Se,Ga);Cr(n,l,Se,void 0);break;default:if(!ee(n,r))break t}}return n}var Ya=[1];function Oi(r){St.call(this,r)}w(Oi,St);function ce(r){St.call(this,r,-1,Wa)}w(ce,St),ce.prototype.getVertexType=function(){return le(this,1,0)},ce.prototype.getPrimitiveType=function(){return le(this,2,0)},ce.prototype.getVertexBufferList=function(){return vr(this)},ce.prototype.getIndexBufferList=function(){return ci(this,4)};function Ha(r,n){for(;Jt(n);)switch(n.i){case 8:var l=bt(n.g);Q(r,1,l);break;case 16:l=bt(n.g),Q(r,2,l);break;case 29:case 26:dr(n,r.getVertexBufferList());break;case 32:case 34:l=n;var g=r.getIndexBufferList();l.h==2?gr(l,oe.prototype.i,g):g.push(l.g.i());break;default:if(!ee(r,n))return r}return r}var Wa=[3,4];function di(r){St.call(this,r)}w(di,St),di.prototype.getMesh=function(){return xr(this,ce,1)},di.prototype.getPoseTransformMatrix=function(){return xr(this,he,2)};function $a(r){t:{var n=new di;for(r=new De(r);Jt(r);)switch(r.i){case 10:var l=ui(r,new ce,Ha);Sr(n,1,l);break;case 18:l=ui(r,new he,Ua),Sr(n,2,l);break;default:if(!ee(n,r))break t}}return n}function br(r,n,l){if(l=r.createShader(l===0?r.VERTEX_SHADER:r.FRAGMENT_SHADER),r.shaderSource(l,n),r.compileShader(l),!r.getShaderParameter(l,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+r.getShaderInfoLog(l));return l}function Ja(r){return gi(r,Ne).map(function(n){return{index:le(n,1,0),Y:Wt(n,2),label:ft(n,3)!=null?le(n,3,""):void 0,displayName:ft(n,4)!=null?le(n,4,""):void 0}})}function wr(r){return{x:Wt(r,1),y:Wt(r,2),z:Wt(r,3),visibility:ft(r,4)!=null?Wt(r,4):void 0}}function Di(r,n){this.h=r,this.g=n,this.l=0}function Br(r,n,l){return qa(r,n),typeof r.g.canvas.transferToImageBitmap=="function"?Promise.resolve(r.g.canvas.transferToImageBitmap()):l?Promise.resolve(r.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(r.g.canvas):(r.i===void 0&&(r.i=document.createElement("canvas")),new Promise(function(g){r.i.height=r.g.canvas.height,r.i.width=r.g.canvas.width,r.i.getContext("2d",{}).drawImage(r.g.canvas,0,0,r.g.canvas.width,r.g.canvas.height),g(r.i)}))}function qa(r,n){var l=r.g;if(r.m===void 0){var g=br(l,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),m=br(l,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),C=l.createProgram();if(l.attachShader(C,g),l.attachShader(C,m),l.linkProgram(C),!l.getProgramParameter(C,l.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+l.getProgramInfoLog(C));g=r.m=C,l.useProgram(g),m=l.getUniformLocation(g,"sampler0"),r.j={I:l.getAttribLocation(g,"aVertex"),H:l.getAttribLocation(g,"aTex"),da:m},r.s=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,r.s),l.enableVertexAttribArray(r.j.I),l.vertexAttribPointer(r.j.I,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null),r.o=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,r.o),l.enableVertexAttribArray(r.j.H),l.vertexAttribPointer(r.j.H,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null),l.uniform1i(m,0)}g=r.j,l.useProgram(r.m),l.canvas.width=n.width,l.canvas.height=n.height,l.viewport(0,0,n.width,n.height),l.activeTexture(l.TEXTURE0),r.h.bindTexture2d(n.glName),l.enableVertexAttribArray(g.I),l.bindBuffer(l.ARRAY_BUFFER,r.s),l.vertexAttribPointer(g.I,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(g.H),l.bindBuffer(l.ARRAY_BUFFER,r.o),l.vertexAttribPointer(g.H,2,l.FLOAT,!1,0,0),l.bindFramebuffer(l.DRAW_FRAMEBUFFER?l.DRAW_FRAMEBUFFER:l.FRAMEBUFFER,null),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.colorMask(!0,!0,!0,!0),l.drawArrays(l.TRIANGLE_FAN,0,4),l.disableVertexAttribArray(g.I),l.disableVertexAttribArray(g.H),l.bindBuffer(l.ARRAY_BUFFER,null),r.h.bindTexture2d(0)}function Ka(r){this.g=r}var Za=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Qa(r,n){return n+r}function Fr(r,n){window[r]=n}function tn(r){var n=document.createElement("script");return n.setAttribute("src",r),n.setAttribute("crossorigin","anonymous"),new Promise(function(l){n.addEventListener("load",function(){l()},!1),n.addEventListener("error",function(){l()},!1),document.body.appendChild(n)})}function en(){return Bt(this,function r(){return st(r,function(n){switch(n.g){case 1:return n.m=2,I(n,WebAssembly.instantiate(Za),4);case 4:n.g=3,n.m=0;break;case 2:return n.m=0,n.j=null,n.return(!1);case 3:return n.return(!0)}})})}function ki(r){if(this.g=r,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=r&&r.locateFile||Qa,typeof window=="object")var n=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")n=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.S=n,r.options){n=c(Object.keys(r.options));for(var l=n.next();!l.done;l=n.next()){l=l.value;var g=r.options[l].default;g!==void 0&&(this.j[l]=typeof g=="function"?g():g)}}}a=ki.prototype,a.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function rn(r,n){return r.g.files===void 0?[]:typeof r.g.files=="function"?r.g.files(n):r.g.files}function sn(r){return Bt(r,function n(){var l=this,g,m,C,p,M,B,V,G,ht,q,H;return st(n,function(O){switch(O.g){case 1:return g=l,l.R?(m=rn(l,l.j),I(O,en(),2)):O.return();case 2:if(C=O.h,typeof window=="object")return Fr("createMediapipeSolutionsWasm",{locateFile:l.locateFile}),Fr("createMediapipeSolutionsPackedAssets",{locateFile:l.locateFile}),B=m.filter(function(Y){return Y.data!==void 0}),V=m.filter(function(Y){return Y.data===void 0}),G=Promise.all(B.map(function(Y){var $=Ni(g,Y.url);if(Y.path!==void 0){var tt=Y.path;$=$.then(function(Ct){return g.overrideFile(tt,Ct),Promise.resolve(Ct)})}return $})),ht=Promise.all(V.map(function(Y){return Y.simd===void 0||Y.simd&&C||!Y.simd&&!C?tn(g.locateFile(Y.url,g.S)):Promise.resolve()})).then(function(){return Bt(g,function Y(){var $,tt,Ct=this;return st(Y,function(ct){if(ct.g==1)return $=window.createMediapipeSolutionsWasm,tt=window.createMediapipeSolutionsPackedAssets,I(ct,$(tt),2);Ct.h=ct.h,ct.g=0})})}),q=(function(){return Bt(g,function Y(){var $=this;return st(Y,function(tt){return $.g.graph&&$.g.graph.url?tt=I(tt,Ni($,$.g.graph.url),0):(tt.g=0,tt=void 0),tt})})})(),I(O,Promise.all([ht,G,q]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return p=m.filter(function(Y){return Y.simd===void 0||Y.simd&&C||!Y.simd&&!C}).map(function(Y){return g.locateFile(Y.url,g.S)}),importScripts.apply(null,h(p)),I(O,createMediapipeSolutionsWasm(Module),6);case 6:l.h=O.h,l.l=new OffscreenCanvas(1,1),l.h.canvas=l.l,M=l.h.GL.createContext(l.l,{antialias:!1,alpha:!1,ba:typeof WebGL2RenderingContext<"u"?2:1}),l.h.GL.makeContextCurrent(M),O.g=4;break;case 7:if(l.l=document.createElement("canvas"),H=l.l.getContext("webgl2",{}),!H&&(H=l.l.getContext("webgl",{}),!H))return alert("Failed to create WebGL canvas context when passing video frame."),O.return();l.D=H,l.h.canvas=l.l,l.h.createContext(l.l,!0,!0,{});case 4:l.i=new l.h.SolutionWasm,l.R=!1,O.g=0}})})}function an(r){return Bt(r,function n(){var l=this,g,m,C,p,M,B,V,G;return st(n,function(ht){if(ht.g==1){if(l.g.graph&&l.g.graph.url&&l.P===l.g.graph.url)return ht.return();if(l.o=!0,!l.g.graph||!l.g.graph.url){ht.g=2;return}return l.P=l.g.graph.url,I(ht,Ni(l,l.g.graph.url),3)}for(ht.g!=2&&(g=ht.h,l.i.loadGraph(g)),m=c(Object.keys(l.B)),C=m.next();!C.done;C=m.next())p=C.value,l.i.overrideFile(p,l.B[p]);if(l.B={},l.g.listeners)for(M=c(l.g.listeners),B=M.next();!B.done;B=M.next())V=B.value,un(l,V);G=l.j,l.j={},l.setOptions(G),ht.g=0})})}a.reset=function(){return Bt(this,function r(){var n=this;return st(r,function(l){n.i&&(n.i.reset(),n.m={},n.s={}),l.g=0})})},a.setOptions=function(r,n){var l=this;if(n=n||this.g.options){for(var g=[],m=[],C={},p=c(Object.keys(r)),M=p.next();!M.done;C={K:C.K,L:C.L},M=p.next()){var B=M.value;B in this.j&&this.j[B]===r[B]||(this.j[B]=r[B],M=n[B],M!==void 0&&(M.onChange&&(C.K=M.onChange,C.L=r[B],g.push((function(V){return function(){return Bt(l,function G(){var ht,q=this;return st(G,function(H){if(H.g==1)return I(H,V.K(V.L),2);ht=H.h,ht===!0&&(q.o=!0),H.g=0})})}})(C))),M.graphOptionXref&&(B={valueNumber:M.type===1?r[B]:0,valueBoolean:M.type===0?r[B]:!1,valueString:M.type===2?r[B]:""},M=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),M.graphOptionXref),B),m.push(M))))}(g.length!==0||m.length!==0)&&(this.o=!0,this.A=(this.A===void 0?[]:this.A).concat(m),this.u=(this.u===void 0?[]:this.u).concat(g))}};function nn(r){return Bt(r,function n(){var l=this,g,m,C,p,M,B,V;return st(n,function(G){switch(G.g){case 1:if(!l.o)return G.return();if(!l.u){G.g=2;break}g=c(l.u),m=g.next();case 3:if(m.done){G.g=5;break}return C=m.value,I(G,C(),4);case 4:m=g.next(),G.g=3;break;case 5:l.u=void 0;case 2:if(l.A){for(p=new l.h.GraphOptionChangeRequestList,M=c(l.A),B=M.next();!B.done;B=M.next())V=B.value,p.push_back(V);l.i.changeOptions(p),p.delete(),l.A=void 0}l.o=!1,G.g=0}})})}a.initialize=function(){return Bt(this,function r(){var n=this;return st(r,function(l){return l.g==1?I(l,sn(n),2):l.g!=3?I(l,an(n),3):I(l,nn(n),0)})})};function Ni(r,n){return Bt(r,function l(){var g=this,m,C;return st(l,function(p){return n in g.F?p.return(g.F[n]):(m=g.locateFile(n,""),C=fetch(m).then(function(M){return M.arrayBuffer()}),g.F[n]=C,p.return(C))})})}a.overrideFile=function(r,n){this.i?this.i.overrideFile(r,n):this.B[r]=n},a.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},a.send=function(r,n){return Bt(this,function l(){var g=this,m,C,p,M,B,V,G,ht,q;return st(l,function(H){switch(H.g){case 1:return g.g.inputs?(m=1e3*(n??performance.now()),I(H,g.C,2)):H.return();case 2:return I(H,g.initialize(),3);case 3:for(C=new g.h.PacketDataList,p=c(Object.keys(r)),M=p.next();!M.done;M=p.next())if(B=M.value,V=g.g.inputs[B]){t:{var O=g,Y=r[B];switch(V.type){case"video":var $=O.m[V.stream];if($||($=new Di(O.h,O.D),O.m[V.stream]=$),O=$,O.l===0&&(O.l=O.h.createTexture()),typeof HTMLVideoElement<"u"&&Y instanceof HTMLVideoElement){var tt=Y.videoWidth;$=Y.videoHeight}else typeof HTMLImageElement<"u"&&Y instanceof HTMLImageElement?(tt=Y.naturalWidth,$=Y.naturalHeight):(tt=Y.width,$=Y.height);$={glName:O.l,width:tt,height:$},tt=O.g,tt.canvas.width=$.width,tt.canvas.height=$.height,tt.activeTexture(tt.TEXTURE0),O.h.bindTexture2d(O.l),tt.texImage2D(tt.TEXTURE_2D,0,tt.RGBA,tt.RGBA,tt.UNSIGNED_BYTE,Y),O.h.bindTexture2d(0),O=$;break t;case"detections":for($=O.m[V.stream],$||($=new Ka(O.h),O.m[V.stream]=$),O=$,O.data||(O.data=new O.g.DetectionListData),O.data.reset(Y.length),$=0;$<Y.length;++$){tt=Y[$];var Ct=O.data,ct=Ct.setBoundingBox,Ft=$,mt=tt.T,W=new Oi;Q(W,1,mt.Z),Q(W,2,mt.$),Q(W,3,mt.height),Q(W,4,mt.width),Q(W,5,mt.rotation),Q(W,6,mt.X);var it=mt=new Ti;jt(it,1,ft(W,1)),jt(it,2,ft(W,2)),jt(it,3,ft(W,3)),jt(it,4,ft(W,4)),jt(it,5,ft(W,5));var at=ft(W,6);if(at!=null&&at!=null){te(it.g,48);var K=it.g,rt=at;at=0>rt,rt=Math.abs(rt);var nt=rt>>>0;for(rt=Math.floor((rt-nt)/4294967296),rt>>>=0,at&&(rt=~rt>>>0,nt=(~nt>>>0)+1,4294967295<nt&&(nt=0,rt++,4294967295<rt&&(rt=0))),zt=nt,Ht=rt,at=zt,nt=Ht;0<nt||127<at;)K.push(at&127|128),at=(at>>>7|nt<<25)>>>0,nt>>>=7;K.push(at)}if(Ai(W,it),mt=Ei(mt),ct.call(Ct,Ft,mt),tt.O)for(Ct=0;Ct<tt.O.length;++Ct)W=tt.O[Ct],it=!!W.visibility,ct=O.data,Ft=ct.addNormalizedLandmark,mt=$,W=Object.assign(Object.assign({},W),{visibility:it?W.visibility:0}),it=new Se,Q(it,1,W.x),Q(it,2,W.y),Q(it,3,W.z),W.visibility&&Q(it,4,W.visibility),K=W=new Ti,jt(K,1,ft(it,1)),jt(K,2,ft(it,2)),jt(K,3,ft(it,3)),jt(K,4,ft(it,4)),jt(K,5,ft(it,5)),Ai(it,K),W=Ei(W),Ft.call(ct,mt,W);if(tt.M)for(Ct=0;Ct<tt.M.length;++Ct){if(ct=O.data,Ft=ct.addClassification,mt=$,W=tt.M[Ct],it=new Ne,Q(it,2,W.Y),W.index&&Q(it,1,W.index),W.label&&Q(it,3,W.label),W.displayName&&Q(it,4,W.displayName),K=W=new Ti,nt=ft(it,1),nt!=null&&nt!=null)if(te(K.g,8),at=K.g,0<=nt)te(at,nt);else{for(rt=0;9>rt;rt++)at.push(nt&127|128),nt>>=7;at.push(1)}jt(K,2,ft(it,2)),at=ft(it,3),at!=null&&(at=_t(at),te(K.g,26),te(K.g,at.length),xe(K,K.g.end()),xe(K,at)),at=ft(it,4),at!=null&&(at=_t(at),te(K.g,34),te(K.g,at.length),xe(K,K.g.end()),xe(K,at)),Ai(it,K),W=Ei(W),Ft.call(ct,mt,W)}}O=O.data;break t;default:O={}}}switch(G=O,ht=V.stream,V.type){case"video":C.pushTexture2d(Object.assign(Object.assign({},G),{stream:ht,timestamp:m}));break;case"detections":q=G,q.stream=ht,q.timestamp=m,C.pushDetectionList(q);break;default:throw Error("Unknown input config type: '"+V.type+"'")}}return g.i.send(C),I(H,g.C,4);case 4:C.delete(),H.g=0}})})};function on(r,n,l){return Bt(r,function g(){var m,C,p,M,B,V,G=this,ht,q,H,O,Y,$,tt,Ct;return st(g,function(ct){switch(ct.g){case 1:if(!l)return ct.return(n);for(m={},C=0,p=c(Object.keys(l)),M=p.next();!M.done;M=p.next())B=M.value,V=l[B],typeof V!="string"&&V.type==="texture"&&n[V.stream]!==void 0&&++C;1<C&&(G.G=!1),ht=c(Object.keys(l)),M=ht.next();case 2:if(M.done){ct.g=4;break}if(q=M.value,H=l[q],typeof H=="string")return tt=m,Ct=q,I(ct,ln(G,q,n[H]),14);if(O=n[H.stream],H.type==="detection_list"){if(O){for(var Ft=O.getRectList(),mt=O.getLandmarksList(),W=O.getClassificationsList(),it=[],at=0;at<Ft.size();++at){var K=Ft.get(at);t:{var rt=new Oi;for(K=new De(K);Jt(K);)switch(K.i){case 13:var nt=Ot(K);Q(rt,1,nt);break;case 21:nt=Ot(K),Q(rt,2,nt);break;case 29:nt=Ot(K),Q(rt,3,nt);break;case 37:nt=Ot(K),Q(rt,4,nt);break;case 45:nt=Ot(K),Q(rt,5,nt);break;case 48:nt=bt(K.g),Q(rt,6,nt);break;default:if(!ee(rt,K))break t}}rt={Z:Wt(rt,1),$:Wt(rt,2),height:Wt(rt,3),width:Wt(rt,4),rotation:Wt(rt,5,0),X:le(rt,6,0)},K=gi(Pr(mt.get(at)),Se).map(wr);var Ce=W.get(at);t:for(nt=new Li,Ce=new De(Ce);Jt(Ce);)switch(Ce.i){case 10:nt.addClassification(ui(Ce,new Ne,ja));break;default:if(!ee(nt,Ce))break t}rt={T:rt,O:K,M:Ja(nt)},it.push(rt)}Ft=it}else Ft=[];m[q]=Ft,ct.g=7;break}if(H.type==="proto_list"){if(O){for(Ft=Array(O.size()),mt=0;mt<O.size();mt++)Ft[mt]=O.get(mt);O.delete()}else Ft=[];m[q]=Ft,ct.g=7;break}if(O===void 0){ct.g=3;break}if(H.type==="float_list"){m[q]=O,ct.g=7;break}if(H.type==="proto"){m[q]=O,ct.g=7;break}if(H.type!=="texture")throw Error("Unknown output config type: '"+H.type+"'");return Y=G.s[q],Y||(Y=new Di(G.h,G.D),G.s[q]=Y),I(ct,Br(Y,O,G.G),13);case 13:$=ct.h,m[q]=$;case 7:H.transform&&m[q]&&(m[q]=H.transform(m[q])),ct.g=3;break;case 14:tt[Ct]=ct.h;case 3:M=ht.next(),ct.g=2;break;case 4:return ct.return(m)}})})}function ln(r,n,l){return Bt(r,function g(){var m=this,C;return st(g,function(p){return typeof l=="number"||l instanceof Uint8Array||l instanceof m.h.Uint8BlobList?p.return(l):l instanceof m.h.Texture2dDataOut?(C=m.s[n],C||(C=new Di(m.h,m.D),m.s[n]=C),p.return(Br(C,l,m.G))):p.return(void 0)})})}function un(r,n){for(var l=n.name||"$",g=[].concat(h(n.wants)),m=new r.h.StringList,C=c(n.wants),p=C.next();!p.done;p=C.next())m.push_back(p.value);C=r.h.PacketListener.implement({onResults:function(M){for(var B={},V=0;V<n.wants.length;++V)B[g[V]]=M.get(V);var G=r.listeners[l];G&&(r.C=on(r,B,n.outs).then(function(ht){ht=G(ht);for(var q=0;q<n.wants.length;++q){var H=B[g[q]];typeof H=="object"&&H.hasOwnProperty&&H.hasOwnProperty("delete")&&H.delete()}ht&&(r.C=ht)}))}}),r.i.attachMultiListener(m,C),m.delete()}a.onResults=function(r,n){this.listeners[n||"$"]=r},T("Solution",ki),T("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"});function hn(r){r=$a(r);var n=r.getMesh();if(!n)return r;var l=new Float32Array(n.getVertexBufferList());n.getVertexBufferList=function(){return l};var g=new Uint32Array(n.getIndexBufferList());return n.getIndexBufferList=function(){return g},r}var cn={files:[{url:"face_mesh_solution_packed_assets_loader.js"},{simd:!0,url:"face_mesh_solution_simd_wasm_bin.js"},{simd:!1,url:"face_mesh_solution_wasm_bin.js"}],graph:{url:"face_mesh.binarypb"},listeners:[{wants:["multi_face_geometry","image_transformed","multi_face_landmarks"],outs:{image:"image_transformed",multiFaceGeometry:{type:"proto_list",stream:"multi_face_geometry",transform:function(r){return r.map(hn)}},multiFaceLandmarks:{type:"proto_list",stream:"multi_face_landmarks",transform:function(r){return r.map(function(n){return gi(Pr(n),Se).map(wr)})}}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},enableFaceGeometry:{type:0,graphOptionXref:{calculatorName:"EnableFaceGeometryConstant",calculatorType:"ConstantSidePacketCalculator",fieldName:"bool_value"}},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumFaces:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorNumFaces",fieldName:"int_value"}},refineLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorRefineLandmarks",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facelandmarkfrontgpu__facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"facelandmarkfrontgpu__facelandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}},cameraNear:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"near"}},cameraFar:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"far"}},cameraVerticalFovDegrees:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"vertical_fov_degrees"}}}},Ir=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],Vr=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Rr=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],Tr=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Er=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],Ar=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],gn=[].concat(h(Ir),h(Vr),h(Rr),h(Tr),h(Er),h(Ar));function Lr(r){r=r||{},r=Object.assign(Object.assign({},cn),r),this.g=new ki(r)}a=Lr.prototype,a.close=function(){return this.g.close(),Promise.resolve()},a.onResults=function(r){this.g.onResults(r)},a.initialize=function(){return Bt(this,function r(){var n=this;return st(r,function(l){return I(l,n.g.initialize(),0)})})},a.reset=function(){this.g.reset()},a.send=function(r){return Bt(this,function n(){var l=this;return st(n,function(g){return I(g,l.g.send(r),0)})})},a.setOptions=function(r){this.g.setOptions(r)},T("FACE_GEOMETRY",{Layout:{COLUMN_MAJOR:0,ROW_MAJOR:1,0:"COLUMN_MAJOR",1:"ROW_MAJOR"},PrimitiveType:{TRIANGLE:0,0:"TRIANGLE"},VertexType:{VERTEX_PT:0,0:"VERTEX_PT"},DEFAULT_CAMERA_PARAMS:{verticalFovDegrees:63,near:1,far:1e4}}),T("FaceMesh",Lr),T("FACEMESH_LIPS",Ir),T("FACEMESH_LEFT_EYE",Vr),T("FACEMESH_LEFT_EYEBROW",Rr),T("FACEMESH_LEFT_IRIS",[[474,475],[475,476],[476,477],[477,474]]),T("FACEMESH_RIGHT_EYE",Tr),T("FACEMESH_RIGHT_EYEBROW",Er),T("FACEMESH_RIGHT_IRIS",[[469,470],[470,471],[471,472],[472,469]]),T("FACEMESH_FACE_OVAL",Ar),T("FACEMESH_CONTOURS",gn),T("FACEMESH_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),T("matrixDataToMatrix",function(r){for(var n=r.getCols(),l=r.getRows(),g=r.getPackedDataList(),m=[],C=0;C<l;C++)m.push(Array(n));for(C=0;C<l;C++)for(var p=0;p<n;p++){var M=r.getLayout()===1?C*n+p:p*l+C;m[C][p]=g[M]}return m}),T("VERSION","0.4.1633559619")}).call(Ji)),Ji}var pl=ml(),qi={},Js;function yl(){return Js||(Js=1,(function(){function a(v){var P=0;return function(){return P<v.length?{done:!1,value:v[P++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,P,k){return v==Array.prototype||v==Object.prototype||(v[P]=k.value),v};function e(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var P=0;P<v.length;++P){var k=v[P];if(k&&k.Math==Math)return k}throw Error("Cannot find global object")}var i=e(this);function s(v,P){if(P)t:{var k=i;v=v.split(".");for(var T=0;T<v.length-1;T++){var ut=v[T];if(!(ut in k))break t;k=k[ut]}v=v[v.length-1],T=k[v],P=P(T),P!=T&&P!=null&&t(k,v,{configurable:!0,writable:!0,value:P})}}s("Symbol",function(v){function P(vt){if(this instanceof P)throw new TypeError("Symbol is not a constructor");return new k(T+(vt||"")+"_"+ut++,vt)}function k(vt,F){this.g=vt,t(this,"description",{configurable:!0,writable:!0,value:F})}if(v)return v;k.prototype.toString=function(){return this.g};var T="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ut=0;return P}),s("Symbol.iterator",function(v){if(v)return v;v=Symbol("Symbol.iterator");for(var P="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),k=0;k<P.length;k++){var T=i[P[k]];typeof T=="function"&&typeof T.prototype[v]!="function"&&t(T.prototype,v,{configurable:!0,writable:!0,value:function(){return o(a(this))}})}return v});function o(v){return v={next:v},v[Symbol.iterator]=function(){return this},v}function u(v){var P=typeof Symbol<"u"&&Symbol.iterator&&v[Symbol.iterator];return P?P.call(v):{next:a(v)}}function c(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function h(v){if(v.i)throw new TypeError("Generator is already running");v.i=!0}c.prototype.l=function(v){this.o=v};function d(v,P){v.h={F:P,G:!0},v.j=v.m}c.prototype.return=function(v){this.h={return:v},this.j=this.m};function _(v){this.g=new c,this.h=v}function y(v,P){h(v.g);var k=v.g.g;return k?S(v,"return"in k?k.return:function(T){return{value:T,done:!0}},P,v.g.return):(v.g.return(P),f(v))}function S(v,P,k,T){try{var ut=P.call(v.g.g,k);if(!(ut instanceof Object))throw new TypeError("Iterator result "+ut+" is not an object");if(!ut.done)return v.g.i=!1,ut;var vt=ut.value}catch(F){return v.g.g=null,d(v.g,F),f(v)}return v.g.g=null,T.call(v.g,vt),f(v)}function f(v){for(;v.g.j;)try{var P=v.h(v.g);if(P)return v.g.i=!1,{value:P.value,done:!1}}catch(k){v.g.o=void 0,d(v.g,k)}if(v.g.i=!1,v.g.h){if(P=v.g.h,v.g.h=null,P.G)throw P.F;return{value:P.return,done:!0}}return{value:void 0,done:!0}}function x(v){this.next=function(P){return h(v.g),v.g.g?P=S(v,v.g.g.next,P,v.g.l):(v.g.l(P),P=f(v)),P},this.throw=function(P){return h(v.g),v.g.g?P=S(v,v.g.g.throw,P,v.g.l):(d(v.g,P),P=f(v)),P},this.return=function(P){return y(v,P)},this[Symbol.iterator]=function(){return this}}function w(v){function P(T){return v.next(T)}function k(T){return v.throw(T)}return new Promise(function(T,ut){function vt(F){F.done?T(F.value):Promise.resolve(F.value).then(P,k).then(vt,ut)}vt(v.next())})}s("Promise",function(v){function P(F){this.h=0,this.i=void 0,this.g=[],this.o=!1;var U=this.j();try{F(U.resolve,U.reject)}catch(et){U.reject(et)}}function k(){this.g=null}function T(F){return F instanceof P?F:new P(function(U){U(F)})}if(v)return v;k.prototype.h=function(F){if(this.g==null){this.g=[];var U=this;this.i(function(){U.l()})}this.g.push(F)};var ut=i.setTimeout;k.prototype.i=function(F){ut(F,0)},k.prototype.l=function(){for(;this.g&&this.g.length;){var F=this.g;this.g=[];for(var U=0;U<F.length;++U){var et=F[U];F[U]=null;try{et()}catch(_t){this.j(_t)}}}this.g=null},k.prototype.j=function(F){this.i(function(){throw F})},P.prototype.j=function(){function F(_t){return function(Pt){et||(et=!0,_t.call(U,Pt))}}var U=this,et=!1;return{resolve:F(this.A),reject:F(this.l)}},P.prototype.A=function(F){if(F===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(F instanceof P)this.C(F);else{t:switch(typeof F){case"object":var U=F!=null;break t;case"function":U=!0;break t;default:U=!1}U?this.v(F):this.m(F)}},P.prototype.v=function(F){var U=void 0;try{U=F.then}catch(et){this.l(et);return}typeof U=="function"?this.D(U,F):this.m(F)},P.prototype.l=function(F){this.u(2,F)},P.prototype.m=function(F){this.u(1,F)},P.prototype.u=function(F,U){if(this.h!=0)throw Error("Cannot settle("+F+", "+U+"): Promise already settled in state"+this.h);this.h=F,this.i=U,this.h===2&&this.B(),this.H()},P.prototype.B=function(){var F=this;ut(function(){if(F.I()){var U=i.console;typeof U<"u"&&U.error(F.i)}},1)},P.prototype.I=function(){if(this.o)return!1;var F=i.CustomEvent,U=i.Event,et=i.dispatchEvent;return typeof et>"u"?!0:(typeof F=="function"?F=new F("unhandledrejection",{cancelable:!0}):typeof U=="function"?F=new U("unhandledrejection",{cancelable:!0}):(F=i.document.createEvent("CustomEvent"),F.initCustomEvent("unhandledrejection",!1,!0,F)),F.promise=this,F.reason=this.i,et(F))},P.prototype.H=function(){if(this.g!=null){for(var F=0;F<this.g.length;++F)vt.h(this.g[F]);this.g=null}};var vt=new k;return P.prototype.C=function(F){var U=this.j();F.s(U.resolve,U.reject)},P.prototype.D=function(F,U){var et=this.j();try{F.call(U,et.resolve,et.reject)}catch(_t){et.reject(_t)}},P.prototype.then=function(F,U){function et(Et,Ut){return typeof Et=="function"?function(ne){try{_t(Et(ne))}catch(Qt){Pt(Qt)}}:Ut}var _t,Pt,Nt=new P(function(Et,Ut){_t=Et,Pt=Ut});return this.s(et(F,_t),et(U,Pt)),Nt},P.prototype.catch=function(F){return this.then(void 0,F)},P.prototype.s=function(F,U){function et(){switch(_t.h){case 1:F(_t.i);break;case 2:U(_t.i);break;default:throw Error("Unexpected state: "+_t.h)}}var _t=this;this.g==null?vt.h(et):this.g.push(et),this.o=!0},P.resolve=T,P.reject=function(F){return new P(function(U,et){et(F)})},P.race=function(F){return new P(function(U,et){for(var _t=u(F),Pt=_t.next();!Pt.done;Pt=_t.next())T(Pt.value).s(U,et)})},P.all=function(F){var U=u(F),et=U.next();return et.done?T([]):new P(function(_t,Pt){function Nt(ne){return function(Qt){Et[ne]=Qt,Ut--,Ut==0&&_t(Et)}}var Et=[],Ut=0;do Et.push(void 0),Ut++,T(et.value).s(Nt(Et.length-1),Pt),et=U.next();while(!et.done)})},P});var b=typeof Object.assign=="function"?Object.assign:function(v,P){for(var k=1;k<arguments.length;k++){var T=arguments[k];if(T)for(var ut in T)Object.prototype.hasOwnProperty.call(T,ut)&&(v[ut]=T[ut])}return v};s("Object.assign",function(v){return v||b});var L=this||self,E={facingMode:"user",width:640,height:480};function I(v,P){this.video=v,this.i=0,this.h=Object.assign(Object.assign({},E),P)}I.prototype.stop=function(){var v=this,P,k,T,ut;return w(new x(new _(function(vt){if(v.g){for(P=v.g.getTracks(),k=u(P),T=k.next();!T.done;T=k.next())ut=T.value,ut.stop();v.g=void 0}vt.j=0})))},I.prototype.start=function(){var v=this,P;return w(new x(new _(function(k){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),P=v.h,k.return(navigator.mediaDevices.getUserMedia({video:{facingMode:P.facingMode,width:P.width,height:P.height}}).then(function(T){j(v,T)}).catch(function(T){var ut="Failed to acquire camera feed: "+T;throw console.error(ut),alert(ut),T}))})))};function X(v){window.requestAnimationFrame(function(){R(v)})}function j(v,P){v.g=P,v.video.srcObject=P,v.video.onloadedmetadata=function(){v.video.play(),X(v)}}function R(v){var P=null;v.video.paused||v.video.currentTime===v.i||(v.i=v.video.currentTime,P=v.h.onFrame()),P?P.then(function(){X(v)}):X(v)}var J=["Camera"],gt=L;J[0]in gt||typeof gt.execScript>"u"||gt.execScript("var "+J[0]);for(var st;J.length&&(st=J.shift());)J.length||I===void 0?gt[st]&&gt[st]!==Object.prototype[st]?gt=gt[st]:gt=gt[st]={}:gt[st]=I}).call(qi)),qi}var vl=yl();class xl{constructor(){this.camera=null,this.isRunning=!1,this.currentParams={angleX:0,angleY:0,angleZ:0,eyeLOpen:1,eyeROpen:1,eyeBallX:0,eyeBallY:0,browLY:0,browRY:0,mouthOpenY:0,mouthForm:0},this.smoothingFactor=.5,this.videoElement=document.createElement("video"),this.videoElement.setAttribute("playsinline",""),this.videoElement.style.display="none",document.body.appendChild(this.videoElement),this.canvasElement=document.createElement("canvas"),this.canvasElement.id="face-tracking-preview",this.canvasElement.width=320,this.canvasElement.height=240,this.canvasCtx=this.canvasElement.getContext("2d"),this.faceMesh=new pl.FaceMesh({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${t}`}),this.faceMesh.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.faceMesh.onResults(this.onResults.bind(this))}async start(){return this.isRunning?this.canvasElement:(this.camera=new vl.Camera(this.videoElement,{onFrame:async()=>{await this.faceMesh.send({image:this.videoElement})},width:640,height:480}),await this.camera.start(),this.isRunning=!0,this.canvasElement)}stop(){this.camera&&(this.camera.stop(),this.camera=null),this.isRunning=!1}getPreviewCanvas(){return this.canvasElement}getParams(){return{...this.currentParams}}onResults(t){if(this.canvasCtx.save(),this.canvasCtx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.canvasCtx.translate(this.canvasElement.width,0),this.canvasCtx.scale(-1,1),this.canvasCtx.drawImage(t.image,0,0,this.canvasElement.width,this.canvasElement.height),this.canvasCtx.restore(),t.multiFaceLandmarks&&t.multiFaceLandmarks.length>0){const e=t.multiFaceLandmarks[0];this.calculateParams(e)}}calculateParams(t){const e=t[1],i=t[33],s=t[263],o=t[61],u=t[291],c=t[13],h=t[14],d=t[152],_=t[10],y=t[159],S=t[145],f=t[133],x=t[33],w=t[386],b=t[374],L=t[362],E=t[263],I=t[105],X=t[334],j=Math.abs(s.x-i.x),J=(e.x-(i.x+s.x)/2)/j*60,gt=(i.y+s.y)/2,st=Math.abs(d.y-_.y),v=e.y-gt,P=st*.15,k=(v-P)/st*-60,T=s.y-i.y,ut=Math.atan2(T,j)*(180/Math.PI)*-1,vt=Math.abs(y.y-S.y),F=Math.abs(x.x-f.x),U=vt/F,et=Math.min(1,Math.max(0,U/.25)),_t=Math.abs(w.y-b.y),Pt=Math.abs(E.x-L.x),Nt=_t/Pt,Et=Math.min(1,Math.max(0,Nt/.25)),Ut=J/30,ne=k/30,Qt=(I.y-i.y)*10,Ri=(X.y-s.y)*10,ai=Math.abs(h.y-c.y),ni=Math.abs(u.x-o.x),zt=Math.min(1,ai/ni*3),Ht=(o.y+u.y)/2,oi=((c.y+h.y)/2-Ht)*10,bt=this.smoothingFactor;this.currentParams={angleX:this.lerp(this.currentParams.angleX,this.clamp(k,-30,30),bt),angleY:this.lerp(this.currentParams.angleY,this.clamp(-J,-30,30),bt),angleZ:this.lerp(this.currentParams.angleZ,this.clamp(-ut,-30,30),bt),eyeLOpen:this.lerp(this.currentParams.eyeLOpen,et,bt),eyeROpen:this.lerp(this.currentParams.eyeROpen,Et,bt),eyeBallX:this.lerp(this.currentParams.eyeBallX,this.clamp(-Ut,-1,1),bt),eyeBallY:this.lerp(this.currentParams.eyeBallY,this.clamp(ne,-1,1),bt),browLY:this.lerp(this.currentParams.browLY,this.clamp(Qt,-1,1),bt),browRY:this.lerp(this.currentParams.browRY,this.clamp(Ri,-1,1),bt),mouthOpenY:this.lerp(this.currentParams.mouthOpenY,zt,bt),mouthForm:this.lerp(this.currentParams.mouthForm,this.clamp(oi,-1,1),bt)}}lerp(t,e,i){return t+(e-t)*i}clamp(t,e,i){return Math.min(i,Math.max(e,t))}}let Ki=null;function Oa(){return Ki||(Ki=new xl),Ki}class Sl extends Vi{loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then(i=>i.arrayBuffer()).then(i=>{const s=new ra(i,i.byteLength);this._state=1,this.setupModel(s)}).catch(i=>{lt(`Failed to load file ${this._modelHomeDir}${e}`)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,this._modelSetting.getModelFileName()!=""){const S=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${S}`).then(f=>{if(f.ok)return f.arrayBuffer();if(f.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${S}`),new ArrayBuffer(0)}).then(f=>{this.loadModel(f,this._mocConsistency),this._state=3,e()}),this._state=2}else yt.printMessage("Model data does not exist.");const e=()=>{if(this._modelSetting.getExpressionCount()>0){const S=this._modelSetting.getExpressionCount();for(let f=0;f<S;f++){const x=this._modelSetting.getExpressionName(f),w=this._modelSetting.getExpressionFileName(f);fetch(`${this._modelHomeDir}${w}`).then(b=>{if(b.ok)return b.arrayBuffer();if(b.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${w}`),new ArrayBuffer(0)}).then(b=>{const L=this.loadExpression(b,b.byteLength,x);this._expressions.getValue(x)!=null&&(Oe.delete(this._expressions.getValue(x)),this._expressions.setValue(x,null)),this._expressions.setValue(x,L),this._expressionCount++,this._expressionCount>=S&&(this._state=5,i())})}this._state=4}else this._state=5,i()},i=()=>{if(this._modelSetting.getPhysicsFileName()!=""){const S=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${S}`).then(f=>{if(f.ok)return f.arrayBuffer();if(f.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${S}`),new ArrayBuffer(0)}).then(f=>{this.loadPhysics(f,f.byteLength),this._state=7,s()}),this._state=6}else this._state=7,s()},s=()=>{if(this._modelSetting.getPoseFileName()!=""){const S=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${S}`).then(f=>{if(f.ok)return f.arrayBuffer();if(f.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${S}`),new ArrayBuffer(0)}).then(f=>{this.loadPose(f,f.byteLength),this._state=9,o()}),this._state=8}else this._state=9,o()},o=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=qe.create(this._modelSetting),this._state=10),u()},u=()=>{this._breath=ri.create();const S=new A;S.pushBack(new Fe(this._idParamAngleX,0,15,6.5345,.5)),S.pushBack(new Fe(this._idParamAngleY,0,8,3.5345,.5)),S.pushBack(new Fe(this._idParamAngleZ,0,10,5.5345,.5)),S.pushBack(new Fe(this._idParamBodyAngleX,0,4,15.5345,.5)),S.pushBack(new Fe(Z.getIdManager().getId(D.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(S),this._state=11,c()},c=()=>{if(this._modelSetting.getUserDataFile()!=""){const S=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${S}`).then(f=>{if(f.ok)return f.arrayBuffer();if(f.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${S}`),new ArrayBuffer(0)}).then(f=>{this.loadUserData(f,f.byteLength),this._state=13,h()}),this._state=12}else this._state=13,h()},h=()=>{const S=this._modelSetting.getEyeBlinkParameterCount();for(let f=0;f<S;++f)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(f));this._state=14,d()},d=()=>{const S=this._modelSetting.getLipSyncParameterCount();for(let f=0;f<S;++f)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(f));this._state=15,_()},_=()=>{const S=new Tt;if(this._modelSetting==null||this._modelMatrix==null){lt("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(S),this._modelMatrix.setupFromLayout(S),this._state=16,y()},y=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const S=[],f=this._modelSetting.getMotionGroupCount();for(let x=0;x<f;x++)S[x]=this._modelSetting.getMotionGroupName(x),this._allMotionCount+=this._modelSetting.getMotionCount(S[x]);for(let x=0;x<f;x++)this.preLoadMotionGroup(S[x]);f==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))}}setupTextures(){if(this._state==20){const e=this._modelSetting.getTextureCount();for(let i=0;i<e;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let s=this._modelSetting.getTextureFileName(i);s=this._modelHomeDir+s;const o=u=>{this.getRenderer().bindTexture(i,u.id),this._textureCount++,this._textureCount>=e&&(this._state=22)};this._subdelegate.getTextureManager().createTextureFromPngFile(s,!0,o),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;const t=yt.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();const e=Oa().getParams();if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(In,An):this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,e.angleX),this._model.addParameterValueById(this._idParamAngleY,e.angleY),this._model.addParameterValueById(this._idParamAngleZ,e.angleZ),this._model.addParameterValueById(this._idParamBodyAngleX,e.angleY*.3),this._model.addParameterValueById(this._idParamEyeBallX,e.eyeBallX),this._model.addParameterValueById(this._idParamEyeBallY,e.eyeBallY),this._model.setParameterValueById(Z.getIdManager().getId(D.ParamEyeLOpen),e.eyeROpen),this._model.setParameterValueById(Z.getIdManager().getId(D.ParamEyeROpen),e.eyeLOpen),this._model.setParameterValueById(Z.getIdManager().getId(D.ParamMouthOpenY),e.mouthOpenY),this._breath!=null&&this._breath.updateParameters(this._model,t),this._physics!=null&&this._physics.evaluate(this._model,t),this._lipsync){let i=0;this._wavFileHandler.update(t),i=this._wavFileHandler.getRms();for(let s=0;s<this._lipSyncIds.getSize();++s)this._model.addParameterValueById(this._lipSyncIds.at(s),i,.8)}this._pose!=null&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,s,o){if(i==On)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&yt.printMessage("[APP]can't start motion."),Ge;const u=this._modelSetting.getMotionFileName(t,e),c=`${t}_${e}`;let h=this._motions.getValue(c),d=!1;if(h==null)if(fetch(`${this._modelHomeDir}${u}`).then(y=>{if(y.ok)return y.arrayBuffer();if(y.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${u}`),new ArrayBuffer(0)}).then(y=>{h=this.loadMotion(y,y.byteLength,null,s,o,this._modelSetting,t,e,this._motionConsistency)}),h)h.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),d=!0;else return lt("Can't start motion {0} .",u),this._motionManager.setReservePriority(En),Ge;else h.setBeganMotionHandler(o),h.setFinishedMotionHandler(s);const _=this._modelSetting.getMotionSoundFileName(t,e);if(_.localeCompare("")!=0){let y=_;y=this._modelHomeDir+y,this._wavFileHandler.start(y)}return this._debugMode&&yt.printMessage(`[APP]start motion: [${t}_${e}]`),this._motionManager.startMotionPriority(h,d,i)}startRandomMotion(t,e,i,s){if(this._modelSetting.getMotionCount(t)==0)return Ge;const o=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,o,e,i,s)}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&yt.printMessage(`[APP]expression: [${t}]`),e!=null?this._expressionManager.startMotion(e,!1):this._debugMode&&yt.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(this._expressions.getSize()==0)return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const i=this._expressions._keyValues[e].first;this.setExpression(i);return}}motionEventFired(t){Vt("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const s=this._modelSetting.getHitAreasCount();for(let o=0;o<s;o++)if(this._modelSetting.getHitAreaName(o)==t){const u=this._modelSetting.getHitAreaId(o);return this.isHit(u,e,i)}return!1}preLoadMotionGroup(t){for(let e=0;e<this._modelSetting.getMotionCount(t);e++){const i=this._modelSetting.getMotionFileName(t,e),s=`${t}_${e}`;this._debugMode&&yt.printMessage(`[APP]load motion: ${i} => [${s}]`),fetch(`${this._modelHomeDir}${i}`).then(o=>{if(o.ok)return o.arrayBuffer();if(o.status>=400)return lt(`Failed to load file ${this._modelHomeDir}${i}`),new ArrayBuffer(0)}).then(o=>{const u=this.loadMotion(o,o.byteLength,s,null,null,this._modelSetting,t,e,this._motionConsistency);u!=null?(u.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(s)!=null&&Oe.delete(this._motions.getValue(s)),this._motions.setValue(s,u),this._motionCount++):this._allMotionCount--,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;const t=this._subdelegate.getCanvas(),e=[0,0,t.width,t.height];this.getRenderer().setRenderState(this._subdelegate.getFrameBuffer(),e),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==22&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(It(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=si.hasMocConsistency(i),this._consistency?Vt("Consistent MOC3."):Vt("Inconsistent MOC3."),this._consistency}else yt.printMessage("Model data does not exist.")}setSubdelegate(t){this._subdelegate=t}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new A,this._lipSyncIds=new A,this._motions=new Tt,this._expressions=new Tt,this._hitArea=new A,this._userArea=new A,this._idParamAngleX=Z.getIdManager().getId(D.ParamAngleX),this._idParamAngleY=Z.getIdManager().getId(D.ParamAngleY),this._idParamAngleZ=Z.getIdManager().getId(D.ParamAngleZ),this._idParamEyeBallX=Z.getIdManager().getId(D.ParamEyeBallX),this._idParamEyeBallY=Z.getIdManager().getId(D.ParamEyeBallY),this._idParamBodyAngleX=Z.getIdManager().getId(D.ParamBodyAngleX),this._mocConsistency=!0,this._motionConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new ur,this._consistency=!1}}class Cl{constructor(){this.beganMotion=t=>{yt.printMessage("Motion Began:"),console.log(t)},this.finishedMotion=t=>{yt.printMessage("Motion Finished:"),console.log(t)},this._subdelegate=null,this._viewMatrix=new pt,this._models=new A,this._sceneIndex=0}releaseAllModel(){this._models.clear()}onDrag(t,e){const i=this._models.at(0);i&&i.setDragging(t,e)}onTap(t,e){const i=this._models.at(0);i.hitTest(Rn,t,e)?i.setRandomExpression():i.hitTest(Tn,t,e)&&i.startRandomMotion(Vn,Ln,this.finishedMotion,this.beganMotion)}onUpdate(){const{width:t,height:e}=this._subdelegate.getCanvas(),i=new pt,s=this._models.at(0);s.getModel()&&(s.getModel().getCanvasWidth()>1&&t<e?(s.getModelMatrix().setWidth(2),i.scale(1,t/e)):i.scale(e/t,1),this._viewMatrix!=null&&i.multiplyByMatrix(this._viewMatrix)),s.update(),s.draw(i)}nextScene(){const t=(this._sceneIndex+1)%Fn;this.changeScene(t)}changeScene(t){this._sceneIndex=t;const e=Qi[t],i=ta+e+"/";let s=Qi[t];s+=".model3.json",this.releaseAllModel();const o=new Sl;o.setSubdelegate(this._subdelegate),o.loadAssets(i,s),this._models.pushBack(o)}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}addModel(t=0){this._sceneIndex=t,this.changeScene(this._sceneIndex)}release(){}initialize(t){this._subdelegate=t,this.changeScene(this._sceneIndex)}}class Ml{constructor(){this._textures=new A}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())this._glManager.getGl().deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let o=this._textures.begin();o.notEqual(this._textures.end());o.preIncrement())if(o.ptr().fileName==t&&o.ptr().usePremultply==e){o.ptr().img=new Image,o.ptr().img.addEventListener("load",()=>i(o.ptr()),{passive:!0}),o.ptr().img.src=t;return}const s=new Image;s.addEventListener("load",()=>{const o=this._glManager.getGl().createTexture();this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,o),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MIN_FILTER,this._glManager.getGl().LINEAR_MIPMAP_LINEAR),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MAG_FILTER,this._glManager.getGl().LINEAR),e&&this._glManager.getGl().pixelStorei(this._glManager.getGl().UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._glManager.getGl().texImage2D(this._glManager.getGl().TEXTURE_2D,0,this._glManager.getGl().RGBA,this._glManager.getGl().RGBA,this._glManager.getGl().UNSIGNED_BYTE,s),this._glManager.getGl().generateMipmap(this._glManager.getGl().TEXTURE_2D),this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,null);const u=new Pl;u!=null&&(u.fileName=t,u.width=s.width,u.height=s.height,u.id=o,u.img=s,u.usePremultply=e,this._textures!=null&&this._textures.pushBack(u)),i(u)},{passive:!0}),s.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._glManager.getGl().deleteTexture(this._textures.at(t).id),this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._glManager.getGl().deleteTexture(this._textures.at(e).id),this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._glManager.getGl().deleteTexture(this._textures.at(e).id),this._textures.set(e,null),this._textures.remove(e);break}}setGlManager(t){this._glManager=t}}class Pl{constructor(){this.id=null,this.width=0,this.height=0}}class Da extends pt{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);pt.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const s=this.getMaxScale(),o=this.getMinScale(),u=i*this._tr[0];u<o?this._tr[0]>0&&(i=o/this._tr[0]):u>s&&this._tr[0]>0&&(i=s/this._tr[0]);const c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),h=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),d=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);pt.multiply(d,this._tr,this._tr),pt.multiply(h,this._tr,this._tr),pt.multiply(c,this._tr,this._tr)}setScreenRect(t,e,i,s){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=s}setMaxScreenRect(t,e,i,s){this._maxLeft=t,this._maxRight=e,this._maxTop=s,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var qs;(a=>{a.CubismViewMatrix=Da})(qs||(qs={}));class Ks{constructor(t,e,i,s,o){this._rect=new bl,this._rect.left=t-i*.5,this._rect.right=t+i*.5,this._rect.up=e+s*.5,this._rect.down=e-s*.5,this._texture=o,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null;const t=this._subdelegate.getGlManager().getGl();t.deleteTexture(this._texture),this._texture=null,t.deleteBuffer(this._uvBuffer),this._uvBuffer=null,t.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,t.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture==null)return;const e=this._subdelegate.getGlManager().getGl();if(this._firstDraw){this._positionLocation=e.getAttribLocation(t,"position"),e.enableVertexAttribArray(this._positionLocation),this._uvLocation=e.getAttribLocation(t,"uv"),e.enableVertexAttribArray(this._uvLocation),this._textureLocation=e.getUniformLocation(t,"texture"),e.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=e.createBuffer();{const i=this._subdelegate.getCanvas().width,s=this._subdelegate.getCanvas().height;this._positionArray=new Float32Array([(this._rect.right-i*.5)/(i*.5),(this._rect.up-s*.5)/(s*.5),(this._rect.left-i*.5)/(i*.5),(this._rect.up-s*.5)/(s*.5),(this._rect.left-i*.5)/(i*.5),(this._rect.down-s*.5)/(s*.5),(this._rect.right-i*.5)/(i*.5),(this._rect.down-s*.5)/(s*.5)]),this._vertexBuffer=e.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=e.createBuffer(),this._firstDraw=!1}e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this._uvArray,e.STATIC_DRAW),e.vertexAttribPointer(this._uvLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this._positionArray,e.STATIC_DRAW),e.vertexAttribPointer(this._positionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indexArray,e.DYNAMIC_DRAW),e.bindTexture(e.TEXTURE_2D,this._texture),e.drawElements(e.TRIANGLES,this._indexArray.length,e.UNSIGNED_SHORT,0)}isHit(t,e){const{height:i}=this._subdelegate.getCanvas(),s=i-e;return t>=this._rect.left&&t<=this._rect.right&&s<=this._rect.up&&s>=this._rect.down}setSubdelegate(t){this._subdelegate=t}}class bl{}class wl{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,s=Math.abs(t),o=Math.abs(e);return i*(s<o?s:o)}}class Bl{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new wl,this._deviceToScreen=new pt,this._viewMatrix=new Da}initialize(t){this._subdelegate=t;const{width:e,height:i}=t.getCanvas(),s=e/i,o=-s,u=s,c=xn,h=Sn;if(this._viewMatrix.setScreenRect(o,u,c,h),this._viewMatrix.scale(Wr,Wr),this._deviceToScreen.loadIdentity(),e>i){const d=Math.abs(u-o);this._deviceToScreen.scaleRelative(d/e,-d/e)}else{const d=Math.abs(h-c);this._deviceToScreen.scaleRelative(d/i,-d/i)}this._deviceToScreen.translateRelative(-e*.5,-i*.5),this._viewMatrix.setMaxScale(yn),this._viewMatrix.setMinScale(vn),this._viewMatrix.setMaxScreenRect(Cn,Mn,Pn,bn)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,this._subdelegate.getGlManager().getGl().deleteProgram(this._programId),this._programId=null}render(){this._subdelegate.getGlManager().getGl().useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),this._subdelegate.getGlManager().getGl().flush();const t=this._subdelegate.getLive2DManager();t!=null&&(t.setViewMatrix(this._viewMatrix),t.onUpdate())}initializeSprite(){const t=this._subdelegate.getCanvas().width,e=this._subdelegate.getCanvas().height,i=this._subdelegate.getTextureManager(),s=ta;let o="";o=wn;const u=h=>{const d=t*.5,_=e*.5,y=h.width*2,S=e*.95;this._back=new Ks(d,_,y,S,h.id),this._back.setSubdelegate(this._subdelegate)};i.createTextureFromPngFile(s+o,!1,u),o=Bn;const c=h=>{const d=t-h.width*.5,_=e-h.height*.5,y=h.width,S=h.height;this._gear=new Ks(d,_,y,S,h.id),this._gear.setSubdelegate(this._subdelegate)};i.createTextureFromPngFile(s+o,!1,c),this._programId==null&&(this._programId=this._subdelegate.createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t*window.devicePixelRatio,e*window.devicePixelRatio)}onTouchesMoved(t,e){const i=t*window.devicePixelRatio,s=e*window.devicePixelRatio,o=this._subdelegate.getLive2DManager(),u=this.transformViewX(this._touchManager.getX()),c=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(i,s),o.onDrag(u,c)}onTouchesEnded(t,e){const i=t*window.devicePixelRatio,s=e*window.devicePixelRatio,o=this._subdelegate.getLive2DManager();o.onDrag(0,0);const u=this.transformViewX(i),c=this.transformViewY(s);o.onTap(u,c),this._gear.isHit(i,s)&&o.nextScene()}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}class Fl{constructor(){this._canvas=null,this._glManager=new kn,this._textureManager=new Ml,this._live2dManager=new Cl,this._view=new Bl,this._frameBuffer=null,this._captured=!1}release(){this._resizeObserver.unobserve(this._canvas),this._resizeObserver.disconnect(),this._resizeObserver=null,this._live2dManager.release(),this._live2dManager=null,this._view.release(),this._view=null,this._textureManager.release(),this._textureManager=null,this._glManager.release(),this._glManager=null}initialize(t){if(!this._glManager.initialize(t))return!1;this._canvas=t,me==="auto"?this.resizeCanvas():(t.width=me.width,t.height=me.height),this._textureManager.setGlManager(this._glManager);const e=this._glManager.getGl();return this._frameBuffer||(this._frameBuffer=e.getParameter(e.FRAMEBUFFER_BINDING)),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._view.initialize(this),this._view.initializeSprite(),this._live2dManager.initialize(this),this._resizeObserver=new ResizeObserver((i,s)=>this.resizeObserverCallback.call(this,i,s)),this._resizeObserver.observe(this._canvas),!0}onResize(){this.resizeCanvas(),this._view.initialize(this),this._view.initializeSprite()}resizeObserverCallback(t,e){me==="auto"&&(this._needResize=!0)}update(){if(this._glManager.getGl().isContextLost())return;this._needResize&&(this.onResize(),this._needResize=!1);const t=this._glManager.getGl();t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.clearDepth(1),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._view.render()}createShader(){const t=this._glManager.getGl(),e=t.createShader(t.VERTEX_SHADER);if(e==null)return yt.printMessage("failed to create vertexShader"),null;t.shaderSource(e,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),t.compileShader(e);const s=t.createShader(t.FRAGMENT_SHADER);if(s==null)return yt.printMessage("failed to create fragmentShader"),null;t.shaderSource(s,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),t.compileShader(s);const u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,s),t.deleteShader(e),t.deleteShader(s),t.linkProgram(u),t.useProgram(u),u}getTextureManager(){return this._textureManager}getFrameBuffer(){return this._frameBuffer}getCanvas(){return this._canvas}getGlManager(){return this._glManager}getLive2DManager(){return this._live2dManager}resizeCanvas(){this._canvas.width=this._canvas.clientWidth*window.devicePixelRatio,this._canvas.height=this._canvas.clientHeight*window.devicePixelRatio;const t=this._glManager.getGl();t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)}onPointBegan(t,e){if(!this._view){yt.printMessage("view notfound");return}this._captured=!0;const i=t-this._canvas.offsetLeft,s=e-this._canvas.offsetTop;this._view.onTouchesBegan(i,s)}onPointMoved(t,e){if(!this._captured)return;const i=t-this._canvas.offsetLeft,s=e-this._canvas.offsetTop;this._view.onTouchesMoved(i,s)}onPointEnded(t,e){if(this._captured=!1,!this._view){yt.printMessage("view notfound");return}const i=t-this._canvas.offsetLeft,s=e-this._canvas.offsetTop;this._view.onTouchesEnded(i,s)}onTouchCancel(t,e){if(this._captured=!1,!this._view){yt.printMessage("view notfound");return}const i=t-this._canvas.offsetLeft,s=e-this._canvas.offsetTop;this._view.onTouchesEnded(i,s)}isContextLost(){return this._glManager.getGl().isContextLost()}}let _e=null;class ii{static getInstance(){return _e==null&&(_e=new ii),_e}static releaseInstance(){_e!=null&&_e.release(),_e=null}onPointerBegan(t){for(let e=this._subdelegates.begin();e.notEqual(this._subdelegates.end());e.preIncrement())e.ptr().onPointBegan(t.pageX,t.pageY)}onPointerMoved(t){for(let e=this._subdelegates.begin();e.notEqual(this._subdelegates.end());e.preIncrement())e.ptr().onPointMoved(t.pageX,t.pageY)}onPointerEnded(t){for(let e=this._subdelegates.begin();e.notEqual(this._subdelegates.end());e.preIncrement())e.ptr().onPointEnded(t.pageX,t.pageY)}onPointerCancel(t){for(let e=this._subdelegates.begin();e.notEqual(this._subdelegates.end());e.preIncrement())e.ptr().onTouchCancel(t.pageX,t.pageY)}onResize(){for(let t=0;t<this._subdelegates.getSize();t++)this._subdelegates.at(t).onResize()}run(){const t=()=>{if(_e!=null){yt.updateTime();for(let e=0;e<this._subdelegates.getSize();e++)this._subdelegates.at(e).update();requestAnimationFrame(t)}};t()}release(){this.releaseEventListener(),this.releaseSubdelegates(),Z.dispose(),this._cubismOption=null}releaseEventListener(){document.removeEventListener("pointerup",this.pointBeganEventListener),this.pointBeganEventListener=null,document.removeEventListener("pointermove",this.pointMovedEventListener),this.pointMovedEventListener=null,document.removeEventListener("pointerdown",this.pointEndedEventListener),this.pointEndedEventListener=null,document.removeEventListener("pointerdown",this.pointCancelEventListener),this.pointCancelEventListener=null}releaseSubdelegates(){for(let t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().release();this._subdelegates.clear(),this._subdelegates=null}initialize(){return this.initializeCubism(),this.initializeSubdelegates(),this.initializeEventListener(),!0}initializeEventListener(){this.pointBeganEventListener=this.onPointerBegan.bind(this),this.pointMovedEventListener=this.onPointerMoved.bind(this),this.pointEndedEventListener=this.onPointerEnded.bind(this),this.pointCancelEventListener=this.onPointerCancel.bind(this),document.addEventListener("pointerdown",this.pointBeganEventListener,{passive:!0}),document.addEventListener("pointermove",this.pointMovedEventListener,{passive:!0}),document.addEventListener("pointerup",this.pointEndedEventListener,{passive:!0}),document.addEventListener("pointercancel",this.pointCancelEventListener,{passive:!0})}initializeCubism(){yt.updateTime(),this._cubismOption.logFunction=yt.printMessage,this._cubismOption.loggingLevel=Dn,Z.startUp(this._cubismOption),Z.initialize()}initializeSubdelegates(){let t=100,e=100;t=100/ze,this._canvases.prepareCapacity(ze),this._subdelegates.prepareCapacity(ze);for(let i=0;i<ze;i++){const s=document.createElement("canvas");this._canvases.pushBack(s),me!=="auto"?(s.style.width=`${me.width}px`,s.style.height=`${me.height}px`):(s.style.width=`${t}vw`,s.style.height=`${e}vh`);const o=document.getElementById("live2d-container");o?o.appendChild(s):document.body.appendChild(s)}for(let i=0;i<this._canvases.getSize();i++){const s=new Fl;s.initialize(this._canvases.at(i)),this._subdelegates.pushBack(s)}for(let i=0;i<ze;i++)this._subdelegates.at(i).isContextLost()&&lt(`The context for Canvas at index ${i} was lost, possibly because the acquisition limit for WebGLRenderingContext was reached.`)}constructor(){this._cubismOption=new pn,this._subdelegates=new A,this._canvases=new A}}window.addEventListener("load",async()=>{if(ii.getInstance().initialize()){ii.getInstance().run();try{await Oa().start(),console.log("")}catch(a){console.error(":",a)}}},{passive:!0});window.addEventListener("beforeunload",()=>ii.releaseInstance(),{passive:!0});
